#!/usr/bin/env node

// transpile:testwa

'use strict';

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _appiumLogger = require('appium-logger');

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _uuidJs = require('uuid-js');

var _uuidJs2 = _interopRequireDefault(_uuidJs);

var _appiumIosDriverNode_modulesAppiumUiauto = require('../../../../appium-ios-driver/node_modules/appium-uiauto');

var _asyncbox = require('asyncbox');

var logger = (0, _appiumLogger.getLogger)("TestWa");
var logData = (0, _appiumLogger.getLogger)("TestWaData");

var fs = require('fs'),
    temp = require('temp'),
    _ = require('underscore'),
    testwaresponse = require('./middleware.js'),
    testData = require('./testcasedata.js'),
    async = require('async'),
    ncp = require('ncp').ncp,
    querystring = require("querystring"); //testwa

var testwa = {};
var screenIndex = 0;
var op_alue = "";
var memoryinfo = "0";
var cpurate = "0";
var packagename = "";
var sessionid = "";
var testsuit = "";
var testcaseid = "";
var deviceid = "";
var genTool = false;

testwa.heartbeat = function (args) {
    if (args.waHeartbeat) {
        var returnStatus = { status: 0 };
        //use testwaDeviceId instead of udid for MAC
        if (args.udid) {
            testwaresponse.SendStartStatus(returnStatus, args.udid, args.testcaselogId, args.port);
        } else {
            testwaresponse.SendStartStatus(returnStatus, args.testwaDeviceId, args.testcaselogId, args.port);
        }
    }
};

testwa.responseNoDriver = function (driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var args = driver.args;

    var testDataReply = _.clone(testData);
    testDataReply.testdata.description = "No Driver found for this session, probably appium error, please restart appium!";
    if (args.genTool) {
        // console.log(testDataReply);
        logData.error(testDataReply);
    } else {
        testwaresponse.SendDataNativeApp(testDataReply.testdata);
    }
};

testwa.responseDeleteSession = function (driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var testDataReply = _.clone(testData);
    testDataReply.testdata.status = 0;
    testDataReply.testdata.value = httpResBody.value;
    testDataReply.testdata.runtime = 0;
    testDataReply.testdata.sessionId = httpResBody.sessionId;
    testDataReply.testdata.deviceId = deviceid;
    testDataReply.testdata.testSuit = testsuit;
    testDataReply.testdata.testcaseId = testcaseid;
    testDataReply.testdata.command = { "action": "停止测试", "params": "" };
    testDataReply.testdata.screenshotPath = "";

    var myDate = new Date();
    var endTime = myDate.getTime();
    testDataReply.runtime = endTime - req._startTime.getTime();
    testDataReply.status = httpResBody.status;
    if (null !== httpResBody.value) {
        testDataReply.description = httpResBody.value.message ? httpResBody.value.message : "";
    }

    if (genTool) {
        // console.log(testDataReply);
        logData.error(testDataReply);
    } else {
        testwaresponse.SendDataNativeApp(testDataReply.testdata);
    }
};

testwa.handler = function callee$0$0(driver, req, httpStatus, httpResBody, commond, jsonObj) {
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                if (!(commond !== 'deleteSession')) {
                    context$1$0.next = 14;
                    break;
                }

                if (!driver.sessions[httpResBody.sessionId]) {
                    context$1$0.next = 11;
                    break;
                }

                if (!(driver.sessions[httpResBody.sessionId].constructor.name === 'AndroidDriver')) {
                    context$1$0.next = 7;
                    break;
                }

                context$1$0.next = 5;
                return _regeneratorRuntime.awrap(testwa.getActionAndroid(driver, req, httpStatus, httpResBody, commond, jsonObj));

            case 5:
                context$1$0.next = 9;
                break;

            case 7:
                context$1$0.next = 9;
                return _regeneratorRuntime.awrap(testwa.getActionIOS(driver, req, httpStatus, httpResBody, commond, jsonObj));

            case 9:
                context$1$0.next = 12;
                break;

            case 11:
                //no driver found , response error
                testwa.responseNoDriver(driver, req, httpStatus, httpResBody, commond, jsonObj);

            case 12:
                context$1$0.next = 15;
                break;

            case 14:
                //deleteSession
                testwa.responseDeleteSession(driver, req, httpStatus, httpResBody, commond, jsonObj);

            case 15:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

//Android driver
testwa.getTranslationAction = function (commond, jsonObj) {
    if (commond === "createSession") {
        return ["创建会话", ""];
    } else if (commond === "findElements") {
        return ["查找元素（" + jsonObj.using + "）", jsonObj.value];
    } else if (commond === "findElement") {
        return ["查找元素（" + jsonObj.using + "）", jsonObj.value];
    } else if (commond === "click") {
        return ["点击", ""];
    } else if (commond === "setValue") {
        return ["输入", jsonObj.value.join("")];
    } else if (commond === "implicitWait") {
        return ["等待", jsonObj.ms + "ms"];
    } else if (commond === "getWindowSize") {
        return ["获取屏幕大小", ""];
    } else if (commond === "performTouch") {
        if (jsonObj.actions.length === 1) {
            var action = jsonObj.actions[0];
            if (action.action === "longPress") {
                var options = action.options;
                return ["长按", "(x:" + options.x + ",y:" + options.y + ")" + options.duration + "ms"];
            }
        } else if (jsonObj.actions.length === 4) {
            var action1 = jsonObj.actions[0];
            var action3 = jsonObj.actions[2];
            if (action1.action === "press" && action3.action === "moveTo") {
                var options1 = action1.options;
                var options3 = action3.options;
                return ["滑屏", "从(x:" + options1.x + ",y:" + options1.y + ")到(x:" + options3.x + ",y:" + options3.y + ")"];
            }
        }
    }

    return [commond, jsonObj.value];
};
testwa.genRsp = function (driver, req, httpStatus, httpResBody, action, param, cpuRate, memoryInfo) {
    var Driver = driver.sessions[httpResBody.sessionId];
    var caps = Driver.caps;
    var args = driver.args;

    var testDataReply = _.clone(testData);
    testDataReply.testdata.status = httpStatus;
    testDataReply.testdata.value = httpResBody.value;
    testDataReply.testdata.runtime = 0;
    testDataReply.testdata.cpurate = cpuRate ? cpuRate : "0";
    testDataReply.testdata.memory = memoryInfo ? memoryInfo : "0";
    testDataReply.testdata.sessionId = httpResBody.sessionId;
    testDataReply.testdata.deviceId = deviceid = caps ? caps.deviceName : "";
    testDataReply.testdata.testSuit = testsuit = caps ? caps.testSuit : "";
    testDataReply.testdata.testcaseId = testcaseid = caps ? caps.testcaseId : "";
    testDataReply.testdata.command = { "action": action, "params": param };

    var myDate = new Date();
    var endTime = myDate.getTime();
    testDataReply.testdata.runtime = endTime - req._startTime.getTime();
    testDataReply.testdata.status = httpResBody.status;
    if (null !== httpResBody.value) {
        testDataReply.testdata.description = httpResBody.value.message ? httpResBody.value.message : "";
    }

    return [testDataReply, endTime];
};
testwa.getActionAndroid = function callee$0$0(driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var Driver, caps, args, _getTranslationAction, _getTranslationAction2, action, param, _ref, _ref2, memoryInfo, cpuRate, _testwa$genRsp, _testwa$genRsp2, testDataReply, endTime, screenshotPath, tempPng;

    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                Driver = driver.sessions[httpResBody.sessionId];
                caps = Driver.caps;
                args = driver.args;

                genTool = args.genTool;
                // let action = commond;
                // let param = jsonObj.value ? jsonObj.value:jsonObj.ms;

                _getTranslationAction = this.getTranslationAction(commond, jsonObj);
                _getTranslationAction2 = _slicedToArray(_getTranslationAction, 2);
                action = _getTranslationAction2[0];
                param = _getTranslationAction2[1];
                context$1$0.next = 10;
                return _regeneratorRuntime.awrap(this.getPerformance(Driver, httpResBody));

            case 10:
                _ref = context$1$0.sent;
                _ref2 = _slicedToArray(_ref, 2);
                memoryInfo = _ref2[0];
                cpuRate = _ref2[1];
                _testwa$genRsp = testwa.genRsp(driver, req, httpStatus, httpResBody, action, param, cpuRate, memoryInfo);
                _testwa$genRsp2 = _slicedToArray(_testwa$genRsp, 2);
                testDataReply = _testwa$genRsp2[0];
                endTime = _testwa$genRsp2[1];
                screenshotPath = args ? args.screenshotPath : "";
                tempPng = screenshotPath + "/" + endTime + ".png";
                context$1$0.next = 22;
                return _regeneratorRuntime.awrap(testwa.getScreenshotAndroid(Driver, tempPng));

            case 22:
                testDataReply.testdata.screenshotPath = endTime + ".png";

                if (args.genTool) {
                    // console.log(testDataReply);
                    logData.error(testDataReply);
                } else {
                    testwaresponse.SendDataNativeApp(testDataReply.testdata);
                }

            case 24:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

testwa.getActionIOS = function callee$0$0(driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var Driver, caps, args, _getTranslationAction3, _getTranslationAction32, action, param, _testwa$genRsp3, _testwa$genRsp32, testDataReply, endTime, screenshotPath, tempPng;

    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                Driver = driver.sessions[httpResBody.sessionId];
                caps = Driver.caps;
                args = driver.args;

                genTool = args.genTool;

                _getTranslationAction3 = this.getTranslationAction(commond, jsonObj);
                _getTranslationAction32 = _slicedToArray(_getTranslationAction3, 2);
                action = _getTranslationAction32[0];
                param = _getTranslationAction32[1];
                _testwa$genRsp3 = testwa.genRsp(driver, httpStatus, httpResBody, action, param, 0, 0);
                _testwa$genRsp32 = _slicedToArray(_testwa$genRsp3, 2);
                testDataReply = _testwa$genRsp32[0];
                endTime = _testwa$genRsp32[1];
                screenshotPath = args ? args.screenshotPath : "";
                tempPng = screenshotPath + "/" + endTime + ".png";
                context$1$0.next = 16;
                return _regeneratorRuntime.awrap(testwa.getScreenshotIOS(Driver, tempPng));

            case 16:
                testDataReply.testdata.screenshotPath = endTime + ".png";

                if (args.genTool) {
                    // console.log(testDataReply);
                    logData.error(testDataReply);
                } else {
                    testwaresponse.SendDataNativeApp(testDataReply.testdata);
                }

            case 18:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

//get memoryinfo and cpurate
testwa.getPerformance = function callee$0$0(androidDriver, httpResBody) {
    var adb, caps, appName, out, reg_MEM, reg_CPU, memarray, tmpcpurate, memoryinfo, cpurate;
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                logger.debug("Getting device memeory and cpu cost!");
                adb = androidDriver.adb;
                caps = androidDriver.caps;
                appName = caps.appPackage;
                context$1$0.next = 6;
                return _regeneratorRuntime.awrap(adb.shell("top -n 1 -d 0.5 | grep " + appName));

            case 6:
                out = context$1$0.sent;
                reg_MEM = /[0-9]{1,9}([K])/g;
                reg_CPU = /[0-9]{1,2}([%])/g;
                memarray = out.match(reg_MEM);
                tmpcpurate = out.match(reg_CPU);
                memoryinfo = memarray[1];

                memoryinfo = memoryinfo.replace('K', '');
                cpurate = tmpcpurate[0];

                cpurate = cpurate.replace('%', '');
                return context$1$0.abrupt('return', [memoryinfo, cpurate]);

            case 16:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

testwa.getScreenshotAndroid = function callee$0$0(androidDriver, tempPng) {
    var png, cmd;
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                png = '/data/local/tmp/screenshot.png';
                cmd = ['/system/bin/rm', png + ';', '/system/bin/screencap', '-p', png];
                context$1$0.next = 4;
                return _regeneratorRuntime.awrap(androidDriver.adb.shell(cmd));

            case 4:
                context$1$0.next = 6;
                return _regeneratorRuntime.awrap(fs.exists(tempPng));

            case 6:
                if (!context$1$0.sent) {
                    context$1$0.next = 9;
                    break;
                }

                context$1$0.next = 9;
                return _regeneratorRuntime.awrap(fs.unlink(tempPng));

            case 9:
                context$1$0.next = 11;
                return _regeneratorRuntime.awrap(androidDriver.adb.pull(png, tempPng));

            case 11:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

testwa.getScreenshotIOS = function callee$0$0(Driver, tempPng) {
    var guid, shotFile, shotFolder, shotPath, takeScreenShot;
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        var _this = this;

        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                guid = _uuidJs2['default'].create();
                shotFile = 'screenshot' + guid;
                shotFolder = "/tmp/testwa-instruments/Run 1/" + shotFile + ".png";
                ;
                context$1$0.next = 6;
                return _regeneratorRuntime.awrap(fs.exists(shotFolder));

            case 6:
                if (context$1$0.sent) {
                    context$1$0.next = 10;
                    break;
                }

                logger.debug('Creating folder \'' + shotFolder + '\'');
                context$1$0.next = 10;
                return _regeneratorRuntime.awrap(mkdirp(shotFolder));

            case 10:
                shotPath = _path2['default'].resolve(shotFolder, shotFile + '.png');

                logger.debug('Taking screenshot: \'' + shotPath + '\'');

                takeScreenShot = function takeScreenShot() {
                    var screenshotWaitTimeout, startMs, success;
                    return _regeneratorRuntime.async(function takeScreenShot$(context$2$0) {
                        while (1) switch (context$2$0.prev = context$2$0.next) {
                            case 0:
                                context$2$0.next = 2;
                                return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('au.capture(\'' + shotFile + '\')'));

                            case 2:
                                screenshotWaitTimeout = (this.opts.screenshotWaitTimeout || 10) * 1000;

                                logger.debug('Waiting ' + screenshotWaitTimeout + ' ms for screenshot to be generated.');
                                startMs = Date.now();
                                success = false;

                            case 6:
                                if (!(Date.now() - startMs < screenshotWaitTimeout)) {
                                    context$2$0.next = 16;
                                    break;
                                }

                                context$2$0.next = 9;
                                return _regeneratorRuntime.awrap(fs.hasAccess(shotPath));

                            case 9:
                                if (!context$2$0.sent) {
                                    context$2$0.next = 12;
                                    break;
                                }

                                success = true;
                                return context$2$0.abrupt('break', 16);

                            case 12:
                                context$2$0.next = 14;
                                return _regeneratorRuntime.awrap(B.delay(300));

                            case 14:
                                context$2$0.next = 6;
                                break;

                            case 16:
                                if (success) {
                                    context$2$0.next = 18;
                                    break;
                                }

                                throw new errors.UnknownError('Timed out waiting for screenshot file');

                            case 18:
                                context$2$0.next = 20;
                                return _regeneratorRuntime.awrap(this.getOrientation());

                            case 20:
                                context$2$0.t0 = context$2$0.sent;

                                if (!(context$2$0.t0 === 'LANDSCAPE')) {
                                    context$2$0.next = 25;
                                    break;
                                }

                                logger.debug('Rotating landscape screenshot');
                                context$2$0.next = 25;
                                return _regeneratorRuntime.awrap(_appiumIosDriverNode_modulesAppiumUiauto.utils.rotateImage(shotPath, -90));

                            case 25:

                                ncp(shotFolder, temp, function (err) {
                                    if (err) {
                                        return logger.error(err);
                                    }
                                    logger.log('screenshot done!');
                                });

                                return context$2$0.abrupt('return');

                            case 27:
                            case 'end':
                                return context$2$0.stop();
                        }
                    }, null, _this);
                };

            case 13:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

module.exports = testwa;

//Android device

//IOS device

//only difference between ios and android is not getting performance.

// check the rotation, and rotate if necessary
//# sourceMappingURL=data:application/json;base64,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RyxFQUFFO0FBQ0wsK0NBQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztxQ0FDNUI7QUFDRCwwQ0FBTSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO2lDQUFDLENBQUMsQ0FBQzs7Ozs7Ozs7O2lCQUd6Qzs7Ozs7OztDQUNKLENBQUE7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMiLCJmaWxlIjoibGliXFx0ZXN0d2FcXHRlc3R3YS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4vLyB0cmFuc3BpbGU6dGVzdHdhXHJcblxyXG5pbXBvcnQgeyBnZXRMb2dnZXIgfSBmcm9tICdhcHBpdW0tbG9nZ2VyJztcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCB1dWlkIGZyb20gJ3V1aWQtanMnO1xyXG5pbXBvcnQgeyB1dGlscyB9IGZyb20gJy4uLy4uLy4uLy4uL2FwcGl1bS1pb3MtZHJpdmVyL25vZGVfbW9kdWxlcy9hcHBpdW0tdWlhdXRvJztcclxuaW1wb3J0IHsgcmV0cnkgfSBmcm9tICdhc3luY2JveCc7XHJcblxyXG5sZXQgbG9nZ2VyID0gZ2V0TG9nZ2VyKFwiVGVzdFdhXCIpO1xyXG5sZXQgbG9nRGF0YSA9IGdldExvZ2dlcihcIlRlc3RXYURhdGFcIik7XHJcblxyXG5sZXQgIGZzID0gcmVxdWlyZSgnZnMnKVxyXG4gICAgLCB0ZW1wID0gcmVxdWlyZSgndGVtcCcpXHJcbiAgICAsIF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJylcclxuICAgICx0ZXN0d2FyZXNwb25zZSA9IHJlcXVpcmUoJy4vbWlkZGxld2FyZS5qcycpXHJcbiAgICAsdGVzdERhdGEgPSByZXF1aXJlKCcuL3Rlc3RjYXNlZGF0YS5qcycpXHJcbiAgICAsYXN5bmMgPSByZXF1aXJlKCdhc3luYycpXHJcbiAgICAsbmNwID0gcmVxdWlyZSgnbmNwJykubmNwXHJcbiAgICAscXVlcnlzdHJpbmcgPSByZXF1aXJlKFwicXVlcnlzdHJpbmdcIik7Ly90ZXN0d2FcclxuXHJcbmxldCB0ZXN0d2EgPSB7fTtcclxubGV0IHNjcmVlbkluZGV4PTA7XHJcbmxldCBvcF9hbHVlID0gXCJcIjtcclxubGV0IG1lbW9yeWluZm8gPSBcIjBcIjtcclxubGV0IGNwdXJhdGUgPSBcIjBcIjtcclxubGV0IHBhY2thZ2VuYW1lID0gXCJcIjtcclxubGV0IHNlc3Npb25pZCA9IFwiXCI7XHJcbmxldCB0ZXN0c3VpdCA9IFwiXCI7XHJcbmxldCB0ZXN0Y2FzZWlkID0gXCJcIjtcclxubGV0IGRldmljZWlkID0gXCJcIjtcclxubGV0IGdlblRvb2wgPSBmYWxzZTtcclxuXHJcbnRlc3R3YS5oZWFydGJlYXQgPSBmdW5jdGlvbiAoYXJncykge1xyXG4gICAgaWYgKGFyZ3Mud2FIZWFydGJlYXQpIHtcclxuICAgICAgICB2YXIgcmV0dXJuU3RhdHVzID0ge3N0YXR1czogMH07XHJcbiAgICAgICAgLy91c2UgdGVzdHdhRGV2aWNlSWQgaW5zdGVhZCBvZiB1ZGlkIGZvciBNQUNcclxuICAgICAgICBpZiAoYXJncy51ZGlkKSB7XHJcbiAgICAgICAgICAgIHRlc3R3YXJlc3BvbnNlLlNlbmRTdGFydFN0YXR1cyhyZXR1cm5TdGF0dXMsIGFyZ3MudWRpZCwgYXJncy50ZXN0Y2FzZWxvZ0lkLCBhcmdzLnBvcnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGVzdHdhcmVzcG9uc2UuU2VuZFN0YXJ0U3RhdHVzKHJldHVyblN0YXR1cywgYXJncy50ZXN0d2FEZXZpY2VJZCwgYXJncy50ZXN0Y2FzZWxvZ0lkLCBhcmdzLnBvcnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxudGVzdHdhLnJlc3BvbnNlTm9Ecml2ZXIgPSBmdW5jdGlvbiAoZHJpdmVyLCByZXEsIGh0dHBTdGF0dXMsIGh0dHBSZXNCb2R5LCBjb21tb25kLCBqc29uT2JqKSB7XHJcbiAgICBsZXQgYXJncyA9IGRyaXZlci5hcmdzO1xyXG5cclxuICAgIGxldCB0ZXN0RGF0YVJlcGx5ID0gXy5jbG9uZSh0ZXN0RGF0YSk7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLmRlc2NyaXB0aW9uID0gXCJObyBEcml2ZXIgZm91bmQgZm9yIHRoaXMgc2Vzc2lvbiwgcHJvYmFibHkgYXBwaXVtIGVycm9yLCBwbGVhc2UgcmVzdGFydCBhcHBpdW0hXCI7XHJcbiAgICBpZiAoYXJncy5nZW5Ub29sKSB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2codGVzdERhdGFSZXBseSk7XHJcbiAgICAgICAgbG9nRGF0YS5lcnJvcih0ZXN0RGF0YVJlcGx5KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGVzdHdhcmVzcG9uc2UuU2VuZERhdGFOYXRpdmVBcHAodGVzdERhdGFSZXBseS50ZXN0ZGF0YSlcclxuICAgIH1cclxufVxyXG5cclxudGVzdHdhLnJlc3BvbnNlRGVsZXRlU2Vzc2lvbiA9IGZ1bmN0aW9uIChkcml2ZXIsIHJlcSwgaHR0cFN0YXR1cywgaHR0cFJlc0JvZHksIGNvbW1vbmQsIGpzb25PYmopIHtcclxuICAgIGxldCB0ZXN0RGF0YVJlcGx5ID0gXy5jbG9uZSh0ZXN0RGF0YSk7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnN0YXR1cyA9IDA7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnZhbHVlID0gaHR0cFJlc0JvZHkudmFsdWU7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnJ1bnRpbWUgPSAwO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5zZXNzaW9uSWQgPSBodHRwUmVzQm9keS5zZXNzaW9uSWQ7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLmRldmljZUlkID0gZGV2aWNlaWQ7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnRlc3RTdWl0ID0gdGVzdHN1aXQ7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnRlc3RjYXNlSWQgPSB0ZXN0Y2FzZWlkO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5jb21tYW5kID0ge1wiYWN0aW9uXCI6IFwi5YGc5q2i5rWL6K+VXCIsIFwicGFyYW1zXCI6IFwiXCJ9O1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5zY3JlZW5zaG90UGF0aCA9IFwiXCI7XHJcblxyXG4gICAgbGV0IG15RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICBsZXQgZW5kVGltZSA9IG15RGF0ZS5nZXRUaW1lKCk7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnJ1bnRpbWUgPSBlbmRUaW1lIC0gcmVxLl9zdGFydFRpbWUuZ2V0VGltZSgpO1xyXG4gICAgdGVzdERhdGFSZXBseS5zdGF0dXMgPSBodHRwUmVzQm9keS5zdGF0dXM7XHJcbiAgICBpZiAobnVsbCAhPT0gaHR0cFJlc0JvZHkudmFsdWUpIHtcclxuICAgICAgICB0ZXN0RGF0YVJlcGx5LmRlc2NyaXB0aW9uID0gaHR0cFJlc0JvZHkudmFsdWUubWVzc2FnZSA/IGh0dHBSZXNCb2R5LnZhbHVlLm1lc3NhZ2UgOiBcIlwiO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBpZiAoZ2VuVG9vbCkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRlc3REYXRhUmVwbHkpO1xyXG4gICAgICAgIGxvZ0RhdGEuZXJyb3IodGVzdERhdGFSZXBseSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRlc3R3YXJlc3BvbnNlLlNlbmREYXRhTmF0aXZlQXBwKHRlc3REYXRhUmVwbHkudGVzdGRhdGEpO1xyXG4gICAgfVxyXG59XHJcblxyXG50ZXN0d2EuaGFuZGxlciA9IGFzeW5jIGZ1bmN0aW9uIChkcml2ZXIscmVxLGh0dHBTdGF0dXMsaHR0cFJlc0JvZHksY29tbW9uZCxqc29uT2JqKSB7XHJcbiAgICBpZiAoY29tbW9uZCAhPT0gJ2RlbGV0ZVNlc3Npb24nKSB7XHJcbiAgICAgICAgaWYgKGRyaXZlci5zZXNzaW9uc1todHRwUmVzQm9keS5zZXNzaW9uSWRdKSB7XHJcbiAgICAgICAgICAgIGlmIChkcml2ZXIuc2Vzc2lvbnNbaHR0cFJlc0JvZHkuc2Vzc2lvbklkXS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnQW5kcm9pZERyaXZlcicpIHtcclxuICAgICAgICAgICAgICAgIC8vQW5kcm9pZCBkZXZpY2VcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRlc3R3YS5nZXRBY3Rpb25BbmRyb2lkKGRyaXZlciwgcmVxLCBodHRwU3RhdHVzLCBodHRwUmVzQm9keSwgY29tbW9uZCwganNvbk9iaik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL0lPUyBkZXZpY2VcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRlc3R3YS5nZXRBY3Rpb25JT1MoZHJpdmVyLCByZXEsIGh0dHBTdGF0dXMsIGh0dHBSZXNCb2R5LCBjb21tb25kLCBqc29uT2JqKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vbm8gZHJpdmVyIGZvdW5kICwgcmVzcG9uc2UgZXJyb3JcclxuICAgICAgICAgICAgdGVzdHdhLnJlc3BvbnNlTm9Ecml2ZXIoZHJpdmVyLCByZXEsIGh0dHBTdGF0dXMsIGh0dHBSZXNCb2R5LCBjb21tb25kLCBqc29uT2JqKTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vZGVsZXRlU2Vzc2lvblxyXG4gICAgICAgIHRlc3R3YS5yZXNwb25zZURlbGV0ZVNlc3Npb24oZHJpdmVyLHJlcSxodHRwU3RhdHVzLGh0dHBSZXNCb2R5LGNvbW1vbmQsanNvbk9iaik7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vQW5kcm9pZCBkcml2ZXJcclxudGVzdHdhLmdldFRyYW5zbGF0aW9uQWN0aW9uID0gZnVuY3Rpb24gKGNvbW1vbmQsIGpzb25PYmopIHtcclxuICAgIGlmIChjb21tb25kID09PSBcImNyZWF0ZVNlc3Npb25cIikge1xyXG4gICAgICAgIHJldHVybiBbXCLliJvlu7rkvJror51cIixcIlwiXTtcclxuICAgIH0gZWxzZSBpZiAoY29tbW9uZCA9PT0gXCJmaW5kRWxlbWVudHNcIikge1xyXG4gICAgICAgIHJldHVybiBbXCLmn6Xmib7lhYPntKDvvIhcIitqc29uT2JqLnVzaW5nK1wi77yJXCIsanNvbk9iai52YWx1ZV07XHJcbiAgICB9IGVsc2UgaWYoY29tbW9uZCA9PT0gXCJmaW5kRWxlbWVudFwiKSB7XHJcbiAgICAgICAgcmV0dXJuIFtcIuafpeaJvuWFg+e0oO+8iFwiK2pzb25PYmoudXNpbmcrXCLvvIlcIixqc29uT2JqLnZhbHVlXTtcclxuICAgIH0gZWxzZSBpZiAoY29tbW9uZCA9PT0gXCJjbGlja1wiKSB7XHJcbiAgICAgICAgcmV0dXJuIFtcIueCueWHu1wiLFwiXCJdO1xyXG4gICAgfSBlbHNlIGlmIChjb21tb25kID09PSBcInNldFZhbHVlXCIpIHtcclxuICAgICAgICByZXR1cm4gW1wi6L6T5YWlXCIsanNvbk9iai52YWx1ZS5qb2luKFwiXCIpXTtcclxuICAgIH0gZWxzZSBpZiAoY29tbW9uZCA9PT0gXCJpbXBsaWNpdFdhaXRcIikge1xyXG4gICAgICAgIHJldHVybiBbXCLnrYnlvoVcIixqc29uT2JqLm1zK1wibXNcIl07XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1vbmQgPT09IFwiZ2V0V2luZG93U2l6ZVwiKSB7XHJcbiAgICAgICAgcmV0dXJuIFtcIuiOt+WPluWxj+W5leWkp+Wwj1wiLFwiXCJdO1xyXG4gICAgfSBlbHNlIGlmIChjb21tb25kID09PSBcInBlcmZvcm1Ub3VjaFwiKSB7XHJcbiAgICAgICAgaWYgKGpzb25PYmouYWN0aW9ucy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgbGV0IGFjdGlvbiA9IGpzb25PYmouYWN0aW9uc1swXTtcclxuICAgICAgICAgICAgaWYgKGFjdGlvbi5hY3Rpb24gPT09IFwibG9uZ1ByZXNzXCIpIHtcclxuICAgICAgICAgICAgICAgIGxldCBvcHRpb25zID0gYWN0aW9uLm9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW1wi6ZW/5oyJXCIsXCIoeDpcIitvcHRpb25zLngrXCIseTpcIitvcHRpb25zLnkrXCIpXCIrb3B0aW9ucy5kdXJhdGlvbitcIm1zXCJdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChqc29uT2JqLmFjdGlvbnMubGVuZ3RoID09PSA0KSB7XHJcbiAgICAgICAgICAgIGxldCBhY3Rpb24xID0ganNvbk9iai5hY3Rpb25zWzBdO1xyXG4gICAgICAgICAgICBsZXQgYWN0aW9uMyA9IGpzb25PYmouYWN0aW9uc1syXTtcclxuICAgICAgICAgICAgaWYgKGFjdGlvbjEuYWN0aW9uID09PSBcInByZXNzXCIgJiYgYWN0aW9uMy5hY3Rpb24gPT09IFwibW92ZVRvXCIpIHtcclxuICAgICAgICAgICAgICAgIGxldCBvcHRpb25zMSA9IGFjdGlvbjEub3B0aW9ucztcclxuICAgICAgICAgICAgICAgIGxldCBvcHRpb25zMyA9IGFjdGlvbjMub3B0aW9ucztcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXCLmu5HlsY9cIixcIuS7jih4OlwiK29wdGlvbnMxLngrXCIseTpcIitvcHRpb25zMS55K1wiKeWIsCh4OlwiK29wdGlvbnMzLngrXCIseTpcIitvcHRpb25zMy55K1wiKVwiXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gW2NvbW1vbmQsanNvbk9iai52YWx1ZV07XHJcbn1cclxudGVzdHdhLmdlblJzcCA9IGZ1bmN0aW9uIChkcml2ZXIsIHJlcSwgaHR0cFN0YXR1cywgaHR0cFJlc0JvZHksYWN0aW9uLHBhcmFtLGNwdVJhdGUsbWVtb3J5SW5mbykge1xyXG4gICAgbGV0IERyaXZlciA9IGRyaXZlci5zZXNzaW9uc1todHRwUmVzQm9keS5zZXNzaW9uSWRdO1xyXG4gICAgbGV0IGNhcHMgPSBEcml2ZXIuY2FwcztcclxuICAgIGxldCBhcmdzID0gZHJpdmVyLmFyZ3M7XHJcblxyXG4gICAgbGV0IHRlc3REYXRhUmVwbHkgPSBfLmNsb25lKHRlc3REYXRhKTtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuc3RhdHVzID0gaHR0cFN0YXR1cztcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEudmFsdWUgPSBodHRwUmVzQm9keS52YWx1ZTtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEucnVudGltZSA9IDA7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLmNwdXJhdGUgPSBjcHVSYXRlID8gY3B1UmF0ZTpcIjBcIjtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEubWVtb3J5ID0gbWVtb3J5SW5mbyA/IG1lbW9yeUluZm86XCIwXCI7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnNlc3Npb25JZCA9IGh0dHBSZXNCb2R5LnNlc3Npb25JZDtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuZGV2aWNlSWQgPSBkZXZpY2VpZCA9IGNhcHMgPyBjYXBzLmRldmljZU5hbWUgOiBcIlwiO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS50ZXN0U3VpdCA9IHRlc3RzdWl0ID0gY2FwcyA/IGNhcHMudGVzdFN1aXQgOiBcIlwiO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS50ZXN0Y2FzZUlkID0gdGVzdGNhc2VpZCA9IGNhcHMgPyBjYXBzLnRlc3RjYXNlSWQgOiBcIlwiO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5jb21tYW5kID0ge1wiYWN0aW9uXCI6IGFjdGlvbiwgXCJwYXJhbXNcIjogcGFyYW19O1xyXG5cclxuICAgIGxldCBteURhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgbGV0IGVuZFRpbWUgPSBteURhdGUuZ2V0VGltZSgpO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5ydW50aW1lID0gZW5kVGltZSAtIHJlcS5fc3RhcnRUaW1lLmdldFRpbWUoKTtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuc3RhdHVzID0gaHR0cFJlc0JvZHkuc3RhdHVzO1xyXG4gICAgaWYgKG51bGwgIT09IGh0dHBSZXNCb2R5LnZhbHVlKSB7XHJcbiAgICAgICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5kZXNjcmlwdGlvbiA9IGh0dHBSZXNCb2R5LnZhbHVlLm1lc3NhZ2UgPyBodHRwUmVzQm9keS52YWx1ZS5tZXNzYWdlIDogXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gW3Rlc3REYXRhUmVwbHksZW5kVGltZV07XHJcbn1cclxudGVzdHdhLmdldEFjdGlvbkFuZHJvaWQgPSBhc3luYyBmdW5jdGlvbihkcml2ZXIscmVxLGh0dHBTdGF0dXMsaHR0cFJlc0JvZHksY29tbW9uZCxqc29uT2JqKXtcclxuICAgIGxldCBEcml2ZXIgPSBkcml2ZXIuc2Vzc2lvbnNbaHR0cFJlc0JvZHkuc2Vzc2lvbklkXTtcclxuICAgIGxldCBjYXBzID0gRHJpdmVyLmNhcHM7XHJcbiAgICBsZXQgYXJncyA9IGRyaXZlci5hcmdzO1xyXG4gICAgZ2VuVG9vbCA9IGFyZ3MuZ2VuVG9vbDtcclxuICAgIC8vIGxldCBhY3Rpb24gPSBjb21tb25kO1xyXG4gICAgLy8gbGV0IHBhcmFtID0ganNvbk9iai52YWx1ZSA/IGpzb25PYmoudmFsdWU6anNvbk9iai5tcztcclxuXHJcbiAgICBsZXQgW2FjdGlvbixwYXJhbV0gPSB0aGlzLmdldFRyYW5zbGF0aW9uQWN0aW9uKGNvbW1vbmQsanNvbk9iaik7XHJcblxyXG4gICAgbGV0IFttZW1vcnlJbmZvLGNwdVJhdGVdID0gYXdhaXQgdGhpcy5nZXRQZXJmb3JtYW5jZShEcml2ZXIsaHR0cFJlc0JvZHkpO1xyXG5cclxuICAgIGxldCBbdGVzdERhdGFSZXBseSxlbmRUaW1lXSA9IHRlc3R3YS5nZW5Sc3AoZHJpdmVyLHJlcSxodHRwU3RhdHVzLGh0dHBSZXNCb2R5LGFjdGlvbixwYXJhbSxjcHVSYXRlLG1lbW9yeUluZm8pO1xyXG5cclxuICAgIGxldCBzY3JlZW5zaG90UGF0aCA9IGFyZ3MgPyBhcmdzLnNjcmVlbnNob3RQYXRoIDpcIlwiO1xyXG4gICAgbGV0IHRlbXBQbmcgPSBzY3JlZW5zaG90UGF0aCtcIi9cIitlbmRUaW1lK1wiLnBuZ1wiO1xyXG4gICAgYXdhaXQgdGVzdHdhLmdldFNjcmVlbnNob3RBbmRyb2lkKERyaXZlcix0ZW1wUG5nKTtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuc2NyZWVuc2hvdFBhdGggPSBlbmRUaW1lK1wiLnBuZ1wiO1xyXG5cclxuICAgIGlmIChhcmdzLmdlblRvb2wpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZXN0RGF0YVJlcGx5KTtcclxuICAgICAgICBsb2dEYXRhLmVycm9yKHRlc3REYXRhUmVwbHkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0ZXN0d2FyZXNwb25zZS5TZW5kRGF0YU5hdGl2ZUFwcCh0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhKTtcclxuICAgIH1cclxufTtcclxuXHJcbnRlc3R3YS5nZXRBY3Rpb25JT1MgPSBhc3luYyBmdW5jdGlvbiAoZHJpdmVyLCByZXEsIGh0dHBTdGF0dXMsIGh0dHBSZXNCb2R5LCBjb21tb25kLCBqc29uT2JqKSB7XHJcbiAgICAvL29ubHkgZGlmZmVyZW5jZSBiZXR3ZWVuIGlvcyBhbmQgYW5kcm9pZCBpcyBub3QgZ2V0dGluZyBwZXJmb3JtYW5jZS5cclxuICAgIGxldCBEcml2ZXIgPSBkcml2ZXIuc2Vzc2lvbnNbaHR0cFJlc0JvZHkuc2Vzc2lvbklkXTtcclxuICAgIGxldCBjYXBzID0gRHJpdmVyLmNhcHM7XHJcbiAgICBsZXQgYXJncyA9IGRyaXZlci5hcmdzO1xyXG4gICAgZ2VuVG9vbCA9IGFyZ3MuZ2VuVG9vbDtcclxuXHJcbiAgICBsZXQgW2FjdGlvbixwYXJhbV0gPSB0aGlzLmdldFRyYW5zbGF0aW9uQWN0aW9uKGNvbW1vbmQsanNvbk9iaik7XHJcblxyXG4gICAgbGV0IFt0ZXN0RGF0YVJlcGx5LGVuZFRpbWVdID0gdGVzdHdhLmdlblJzcChkcml2ZXIsaHR0cFN0YXR1cyxodHRwUmVzQm9keSxhY3Rpb24scGFyYW0sMCwwKTtcclxuXHJcbiAgICBsZXQgc2NyZWVuc2hvdFBhdGggPSBhcmdzID8gYXJncy5zY3JlZW5zaG90UGF0aDpcIlwiO1xyXG4gICAgbGV0IHRlbXBQbmcgPSBzY3JlZW5zaG90UGF0aCtcIi9cIitlbmRUaW1lK1wiLnBuZ1wiO1xyXG4gICAgYXdhaXQgdGVzdHdhLmdldFNjcmVlbnNob3RJT1MoRHJpdmVyLHRlbXBQbmcpO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5zY3JlZW5zaG90UGF0aCA9IGVuZFRpbWUrXCIucG5nXCI7XHJcblxyXG4gICAgaWYgKGFyZ3MuZ2VuVG9vbCkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRlc3REYXRhUmVwbHkpO1xyXG4gICAgICAgIGxvZ0RhdGEuZXJyb3IodGVzdERhdGFSZXBseSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRlc3R3YXJlc3BvbnNlLlNlbmREYXRhTmF0aXZlQXBwKHRlc3REYXRhUmVwbHkudGVzdGRhdGEpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vL2dldCBtZW1vcnlpbmZvIGFuZCBjcHVyYXRlXHJcbnRlc3R3YS5nZXRQZXJmb3JtYW5jZSA9IGFzeW5jIGZ1bmN0aW9uIChhbmRyb2lkRHJpdmVyLGh0dHBSZXNCb2R5KSB7XHJcbiAgICBsb2dnZXIuZGVidWcoXCJHZXR0aW5nIGRldmljZSBtZW1lb3J5IGFuZCBjcHUgY29zdCFcIik7XHJcbiAgICBsZXQgYWRiID0gYW5kcm9pZERyaXZlci5hZGI7XHJcbiAgICBsZXQgY2FwcyA9IGFuZHJvaWREcml2ZXIuY2FwcztcclxuICAgIGxldCBhcHBOYW1lID0gY2Fwcy5hcHBQYWNrYWdlO1xyXG4gICAgbGV0IG91dCA9IGF3YWl0IGFkYi5zaGVsbChcInRvcCAtbiAxIC1kIDAuNSB8IGdyZXAgXCIrYXBwTmFtZSk7XHJcbiAgICBsZXQgcmVnX01FTSA9IC9bMC05XXsxLDl9KFtLXSkvZztcclxuICAgIGxldCByZWdfQ1BVID0gL1swLTldezEsMn0oWyVdKS9nO1xyXG4gICAgbGV0IG1lbWFycmF5ICA9IG91dC5tYXRjaChyZWdfTUVNKTtcclxuICAgIGxldCB0bXBjcHVyYXRlICA9IG91dC5tYXRjaChyZWdfQ1BVKTtcclxuICAgIGxldCBtZW1vcnlpbmZvID0gbWVtYXJyYXlbMV07XHJcbiAgICBtZW1vcnlpbmZvID0gbWVtb3J5aW5mby5yZXBsYWNlKCdLJywnJyk7XHJcbiAgICBsZXQgY3B1cmF0ZSA9IHRtcGNwdXJhdGVbMF07XHJcbiAgICBjcHVyYXRlID0gY3B1cmF0ZS5yZXBsYWNlKCclJywnJyk7XHJcbiAgICByZXR1cm4gW21lbW9yeWluZm8sY3B1cmF0ZV07XHJcbn07XHJcblxyXG50ZXN0d2EuZ2V0U2NyZWVuc2hvdEFuZHJvaWQgPSBhc3luYyBmdW5jdGlvbiAoYW5kcm9pZERyaXZlciwgdGVtcFBuZykge1xyXG4gICAgY29uc3QgcG5nID0gJy9kYXRhL2xvY2FsL3RtcC9zY3JlZW5zaG90LnBuZyc7XHJcbiAgICBsZXQgY21kID0gIFsnL3N5c3RlbS9iaW4vcm0nLCBgJHtwbmd9O2AsICcvc3lzdGVtL2Jpbi9zY3JlZW5jYXAnLCAnLXAnLCBwbmddO1xyXG4gICAgYXdhaXQgYW5kcm9pZERyaXZlci5hZGIuc2hlbGwoY21kKTtcclxuICAgIGlmIChhd2FpdCBmcy5leGlzdHModGVtcFBuZykpIHtcclxuICAgICAgICBhd2FpdCBmcy51bmxpbmsodGVtcFBuZyk7XHJcbiAgICB9XHJcbiAgICBhd2FpdCBhbmRyb2lkRHJpdmVyLmFkYi5wdWxsKHBuZywgdGVtcFBuZyk7XHJcbn1cclxuXHJcbnRlc3R3YS5nZXRTY3JlZW5zaG90SU9TID0gYXN5bmMgZnVuY3Rpb24gKERyaXZlciwgdGVtcFBuZykge1xyXG4gICAgbGV0IGd1aWQgPSB1dWlkLmNyZWF0ZSgpO1xyXG4gICAgbGV0IHNob3RGaWxlID0gYHNjcmVlbnNob3Qke2d1aWR9YDtcclxuXHJcbiAgICBsZXQgc2hvdEZvbGRlciA9IFwiL3RtcC90ZXN0d2EtaW5zdHJ1bWVudHMvUnVuIDEvXCIrc2hvdEZpbGUrXCIucG5nXCI7O1xyXG4gICAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKHNob3RGb2xkZXIpKSkge1xyXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgQ3JlYXRpbmcgZm9sZGVyICcke3Nob3RGb2xkZXJ9J2ApO1xyXG4gICAgICAgIGF3YWl0IG1rZGlycChzaG90Rm9sZGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgc2hvdFBhdGggPSBwYXRoLnJlc29sdmUoc2hvdEZvbGRlciwgYCR7c2hvdEZpbGV9LnBuZ2ApO1xyXG4gICAgbG9nZ2VyLmRlYnVnKGBUYWtpbmcgc2NyZWVuc2hvdDogJyR7c2hvdFBhdGh9J2ApO1xyXG5cclxuICAgIGxldCB0YWtlU2NyZWVuU2hvdCA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChgYXUuY2FwdHVyZSgnJHtzaG90RmlsZX0nKWApO1xyXG5cclxuICAgICAgICBsZXQgc2NyZWVuc2hvdFdhaXRUaW1lb3V0ID0gKHRoaXMub3B0cy5zY3JlZW5zaG90V2FpdFRpbWVvdXQgfHwgMTApICogMTAwMDtcclxuICAgICAgICBsb2dnZXIuZGVidWcoYFdhaXRpbmcgJHtzY3JlZW5zaG90V2FpdFRpbWVvdXR9IG1zIGZvciBzY3JlZW5zaG90IHRvIGJlIGdlbmVyYXRlZC5gKTtcclxuICAgICAgICBsZXQgc3RhcnRNcyA9IERhdGUubm93KCk7XHJcblxyXG4gICAgICAgIGxldCBzdWNjZXNzID0gZmFsc2U7XHJcbiAgICAgICAgd2hpbGUgKChEYXRlLm5vdygpIC0gc3RhcnRNcykgPCBzY3JlZW5zaG90V2FpdFRpbWVvdXQpIHtcclxuICAgICAgICAgICAgaWYgKGF3YWl0IGZzLmhhc0FjY2VzcyhzaG90UGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXdhaXQgQi5kZWxheSgzMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoJ1RpbWVkIG91dCB3YWl0aW5nIGZvciBzY3JlZW5zaG90IGZpbGUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNoZWNrIHRoZSByb3RhdGlvbiwgYW5kIHJvdGF0ZSBpZiBuZWNlc3NhcnlcclxuICAgICAgICBpZiAoYXdhaXQgdGhpcy5nZXRPcmllbnRhdGlvbigpID09PSAnTEFORFNDQVBFJykge1xyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1JvdGF0aW5nIGxhbmRzY2FwZSBzY3JlZW5zaG90Jyk7XHJcbiAgICAgICAgICAgIGF3YWl0IHV0aWxzLnJvdGF0ZUltYWdlKHNob3RQYXRoLCAtOTApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmNwKHNob3RGb2xkZXIsdGVtcCxmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBsb2dnZXIuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb2dnZXIubG9nKCdzY3JlZW5zaG90IGRvbmUhJyk7fSk7XHJcblxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH07XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gdGVzdHdhOyJdfQ==