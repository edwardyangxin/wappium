#!/usr/bin/env node

// transpile:testwa

'use strict';

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _appiumLogger = require('appium-logger');

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _uuidJs = require('uuid-js');

var _uuidJs2 = _interopRequireDefault(_uuidJs);

var _appiumIosDriverNode_modulesAppiumUiauto = require('../../../../appium-ios-driver/node_modules/appium-uiauto');

var _asyncbox = require('asyncbox');

var logger = (0, _appiumLogger.getLogger)("TestWa");
var logData = (0, _appiumLogger.getLogger)("TestWaData");

var fs = require('fs'),
    temp = require('temp'),
    _ = require('underscore'),
    testwaresponse = require('./middleware.js'),
    testData = require('./testcasedata.js'),
    async = require('async'),
    ncp = require('ncp').ncp,
    querystring = require("querystring"); //testwa

var testwa = {};
var screenIndex = 0;
var op_alue = "";
var memoryinfo = "0";
var cpurate = "0";
var packagename = "";
var sessionid = "";
var testsuit = "";
var testcaseid = "";
var deviceid = "";
var genTool = false;

testwa.heartbeat = function (args) {
    if (args.waHeartbeat) {
        var returnStatus = { status: 0 };
        //use testwaDeviceId instead of udid for MAC
        if (args.udid) {
            testwaresponse.SendStartStatus(returnStatus, args.udid, args.testcaselogId, args.port);
        } else {
            testwaresponse.SendStartStatus(returnStatus, args.testwaDeviceId, args.testcaselogId, args.port);
        }
    }
};

testwa.responseNoDriver = function (driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var args = driver.args;

    var testDataReply = _.clone(testData);
    testDataReply.testdata.description = "No Driver found for this session, probably appium error, please restart appium!";
    if (args.genTool) {
        // console.log(testDataReply);
        logData.error(testDataReply);
    } else {
        testwaresponse.SendDataNativeApp(testDataReply.testdata);
    }
};

testwa.responseDeleteSession = function (driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var testDataReply = _.clone(testData);
    testDataReply.testdata.status = 0;
    testDataReply.testdata.value = httpResBody.value;
    testDataReply.testdata.runtime = 0;
    testDataReply.testdata.sessionId = httpResBody.sessionId;
    testDataReply.testdata.deviceId = deviceid;
    testDataReply.testdata.testSuit = testsuit;
    testDataReply.testdata.testcaseId = testcaseid;
    testDataReply.testdata.command = { "action": "停止测试", "params": "" };
    testDataReply.testdata.screenshotPath = "";

    var myDate = new Date();
    var endTime = myDate.getTime();
    testDataReply.runtime = endTime - req._startTime.getTime();
    testDataReply.status = httpResBody.status;
    if (null !== httpResBody.value) {
        testDataReply.description = httpResBody.value.message ? httpResBody.value.message : "";
    }

    if (genTool) {
        // console.log(testDataReply);
        logData.error(testDataReply);
    } else {
        testwaresponse.SendDataNativeApp(testDataReply.testdata);
    }
};

testwa.handler = function callee$0$0(driver, req, httpStatus, httpResBody, commond, jsonObj) {
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                if (!(commond !== 'deleteSession')) {
                    context$1$0.next = 14;
                    break;
                }

                if (!driver.sessions[httpResBody.sessionId]) {
                    context$1$0.next = 11;
                    break;
                }

                if (!(driver.sessions[httpResBody.sessionId].constructor.name === 'AndroidDriver')) {
                    context$1$0.next = 7;
                    break;
                }

                context$1$0.next = 5;
                return _regeneratorRuntime.awrap(testwa.getActionAndroid(driver, req, httpStatus, httpResBody, commond, jsonObj));

            case 5:
                context$1$0.next = 9;
                break;

            case 7:
                context$1$0.next = 9;
                return _regeneratorRuntime.awrap(testwa.getActionIOS(driver, req, httpStatus, httpResBody, commond, jsonObj));

            case 9:
                context$1$0.next = 12;
                break;

            case 11:
                //no driver found , response error
                testwa.responseNoDriver(driver, req, httpStatus, httpResBody, commond, jsonObj);

            case 12:
                context$1$0.next = 15;
                break;

            case 14:
                //deleteSession
                testwa.responseDeleteSession(driver, req, httpStatus, httpResBody, commond, jsonObj);

            case 15:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

//Android driver
testwa.getTranslationAction = function (commond, jsonObj) {
    if (commond === "createSession") {
        return ["创建会话", ""];
    } else if (commond === "findElements") {
        return ["查找元素（" + jsonObj.using + "）", jsonObj.value];
    } else if (commond === "findElement") {
        return ["查找元素（" + jsonObj.using + "）", jsonObj.value];
    } else if (commond === "click") {
        return ["点击", ""];
    } else if (commond === "setValue") {
        return ["输入", jsonObj.value.join("")];
    } else if (commond === "implicitWait") {
        return ["等待", jsonObj.ms + "ms"];
    } else if (commond === "getWindowSize") {
        return ["获取屏幕大小", ""];
    } else if (commond === "performTouch") {
        if (jsonObj.actions.length === 1) {
            var action = jsonObj.actions[0];
            if (action.action === "longPress") {
                var options = action.options;
                return ["长按", "(x:" + options.x + ",y:" + options.y + ")" + options.duration + "ms"];
            }
        } else if (jsonObj.actions.length === 4) {
            var action1 = jsonObj.actions[0];
            var action3 = jsonObj.actions[2];
            if (action1.action === "press" && action3.action === "moveTo") {
                var options1 = action1.options;
                var options3 = action3.options;
                return ["滑屏", "从(x:" + options1.x + ",y:" + options1.y + ")到(x:" + options3.x + ",y:" + options3.y + ")"];
            }
        }
    }

    return [commond, jsonObj.value];
};
testwa.genRsp = function (driver, req, httpStatus, httpResBody, action, param, cpuRate, memoryInfo) {
    var Driver = driver.sessions[httpResBody.sessionId];
    var caps = Driver.caps;
    var args = driver.args;

    var testDataReply = _.clone(testData);
    testDataReply.testdata.status = httpStatus;
    testDataReply.testdata.value = httpResBody.value;
    testDataReply.testdata.runtime = 0;
    testDataReply.testdata.cpurate = cpuRate ? cpuRate : "0";
    testDataReply.testdata.memory = memoryInfo ? memoryInfo : "0";
    testDataReply.testdata.sessionId = httpResBody.sessionId;
    testDataReply.testdata.deviceId = deviceid = caps ? caps.deviceName : "";
    testDataReply.testdata.testSuit = testsuit = caps ? caps.testSuit : "";
    testDataReply.testdata.testcaseId = testcaseid = caps ? caps.testcaseId : "";
    testDataReply.testdata.command = { "action": action, "params": param };

    var myDate = new Date();
    var endTime = myDate.getTime();
    testDataReply.testdata.runtime = endTime - req._startTime.getTime();
    testDataReply.testdata.status = httpResBody.status;
    if (null !== httpResBody.value) {
        testDataReply.testdata.description = httpResBody.value.message ? httpResBody.value.message : "";
    }

    return [testDataReply, endTime];
};
testwa.getActionAndroid = function callee$0$0(driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var Driver, caps, args, _getTranslationAction, _getTranslationAction2, action, param, _ref, _ref2, memoryInfo, cpuRate, _testwa$genRsp, _testwa$genRsp2, testDataReply, endTime, screenshotPath, tempPng;

    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                Driver = driver.sessions[httpResBody.sessionId];
                caps = Driver.caps;
                args = driver.args;

                genTool = args.genTool;
                // let action = commond;
                // let param = jsonObj.value ? jsonObj.value:jsonObj.ms;

                _getTranslationAction = this.getTranslationAction(commond, jsonObj);
                _getTranslationAction2 = _slicedToArray(_getTranslationAction, 2);
                action = _getTranslationAction2[0];
                param = _getTranslationAction2[1];
                context$1$0.next = 10;
                return _regeneratorRuntime.awrap(this.getPerformance(Driver, httpResBody));

            case 10:
                _ref = context$1$0.sent;
                _ref2 = _slicedToArray(_ref, 2);
                memoryInfo = _ref2[0];
                cpuRate = _ref2[1];
                _testwa$genRsp = testwa.genRsp(driver, req, httpStatus, httpResBody, action, param, cpuRate, memoryInfo);
                _testwa$genRsp2 = _slicedToArray(_testwa$genRsp, 2);
                testDataReply = _testwa$genRsp2[0];
                endTime = _testwa$genRsp2[1];
                screenshotPath = args ? args.screenshotPath : "";
                tempPng = screenshotPath + endTime + ".png";
                context$1$0.next = 22;
                return _regeneratorRuntime.awrap(testwa.getScreenshotAndroid(Driver, tempPng));

            case 22:
                testDataReply.testdata.screenshotPath = endTime + ".png";

                if (args.genTool) {
                    // console.log(testDataReply);
                    logData.error(testDataReply);
                } else {
                    testwaresponse.SendDataNativeApp(testDataReply.testdata);
                }

            case 24:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

testwa.getActionIOS = function callee$0$0(driver, req, httpStatus, httpResBody, commond, jsonObj) {
    var Driver, caps, args, _getTranslationAction3, _getTranslationAction32, action, param, _testwa$genRsp3, _testwa$genRsp32, testDataReply, endTime, screenshotPath, tempPng;

    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                Driver = driver.sessions[httpResBody.sessionId];
                caps = Driver.caps;
                args = driver.args;

                genTool = args.genTool;

                _getTranslationAction3 = this.getTranslationAction(commond, jsonObj);
                _getTranslationAction32 = _slicedToArray(_getTranslationAction3, 2);
                action = _getTranslationAction32[0];
                param = _getTranslationAction32[1];
                _testwa$genRsp3 = testwa.genRsp(driver, httpStatus, httpResBody, action, param, 0, 0);
                _testwa$genRsp32 = _slicedToArray(_testwa$genRsp3, 2);
                testDataReply = _testwa$genRsp32[0];
                endTime = _testwa$genRsp32[1];
                screenshotPath = args ? args.screenshotPath : "";
                tempPng = screenshotPath + endTime + ".png";
                context$1$0.next = 16;
                return _regeneratorRuntime.awrap(testwa.getScreenshotIOS(Driver, tempPng));

            case 16:
                testDataReply.testdata.screenshotPath = endTime + ".png";

                if (args.genTool) {
                    // console.log(testDataReply);
                    logData.error(testDataReply);
                } else {
                    testwaresponse.SendDataNativeApp(testDataReply.testdata);
                }

            case 18:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

//get memoryinfo and cpurate
testwa.getPerformance = function callee$0$0(androidDriver, httpResBody) {
    var adb, caps, appName, out, reg_MEM, reg_CPU, memarray, tmpcpurate, memoryinfo, cpurate;
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                logger.debug("Getting device memeory and cpu cost!");
                adb = androidDriver.adb;
                caps = androidDriver.caps;
                appName = caps.appPackage;
                context$1$0.next = 6;
                return _regeneratorRuntime.awrap(adb.shell("top -n 1 -d 0.5 | grep " + appName));

            case 6:
                out = context$1$0.sent;
                reg_MEM = /[0-9]{1,9}([K])/g;
                reg_CPU = /[0-9]{1,2}([%])/g;
                memarray = out.match(reg_MEM);
                tmpcpurate = out.match(reg_CPU);
                memoryinfo = memarray[1];

                memoryinfo = memoryinfo.replace('K', '');
                cpurate = tmpcpurate[0];

                cpurate = cpurate.replace('%', '');
                return context$1$0.abrupt('return', [memoryinfo, cpurate]);

            case 16:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

testwa.getScreenshotAndroid = function callee$0$0(androidDriver, tempPng) {
    var png, cmd;
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                png = '/data/local/tmp/screenshot.png';
                cmd = ['/system/bin/rm', png + ';', '/system/bin/screencap', '-p', png];
                context$1$0.next = 4;
                return _regeneratorRuntime.awrap(androidDriver.adb.shell(cmd));

            case 4:
                context$1$0.next = 6;
                return _regeneratorRuntime.awrap(fs.exists(tempPng));

            case 6:
                if (!context$1$0.sent) {
                    context$1$0.next = 9;
                    break;
                }

                context$1$0.next = 9;
                return _regeneratorRuntime.awrap(fs.unlink(tempPng));

            case 9:
                context$1$0.next = 11;
                return _regeneratorRuntime.awrap(androidDriver.adb.pull(png, tempPng));

            case 11:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

testwa.getScreenshotIOS = function callee$0$0(Driver, tempPng) {
    var guid, shotFile, shotFolder, shotPath, takeScreenShot;
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
        var _this = this;

        while (1) switch (context$1$0.prev = context$1$0.next) {
            case 0:
                guid = _uuidJs2['default'].create();
                shotFile = 'screenshot' + guid;
                shotFolder = "/tmp/testwa-instruments/Run 1/" + shotFile + ".png";
                ;
                context$1$0.next = 6;
                return _regeneratorRuntime.awrap(fs.exists(shotFolder));

            case 6:
                if (context$1$0.sent) {
                    context$1$0.next = 10;
                    break;
                }

                logger.debug('Creating folder \'' + shotFolder + '\'');
                context$1$0.next = 10;
                return _regeneratorRuntime.awrap(mkdirp(shotFolder));

            case 10:
                shotPath = _path2['default'].resolve(shotFolder, shotFile + '.png');

                logger.debug('Taking screenshot: \'' + shotPath + '\'');

                takeScreenShot = function takeScreenShot() {
                    var screenshotWaitTimeout, startMs, success;
                    return _regeneratorRuntime.async(function takeScreenShot$(context$2$0) {
                        while (1) switch (context$2$0.prev = context$2$0.next) {
                            case 0:
                                context$2$0.next = 2;
                                return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('au.capture(\'' + shotFile + '\')'));

                            case 2:
                                screenshotWaitTimeout = (this.opts.screenshotWaitTimeout || 10) * 1000;

                                logger.debug('Waiting ' + screenshotWaitTimeout + ' ms for screenshot to be generated.');
                                startMs = Date.now();
                                success = false;

                            case 6:
                                if (!(Date.now() - startMs < screenshotWaitTimeout)) {
                                    context$2$0.next = 16;
                                    break;
                                }

                                context$2$0.next = 9;
                                return _regeneratorRuntime.awrap(fs.hasAccess(shotPath));

                            case 9:
                                if (!context$2$0.sent) {
                                    context$2$0.next = 12;
                                    break;
                                }

                                success = true;
                                return context$2$0.abrupt('break', 16);

                            case 12:
                                context$2$0.next = 14;
                                return _regeneratorRuntime.awrap(B.delay(300));

                            case 14:
                                context$2$0.next = 6;
                                break;

                            case 16:
                                if (success) {
                                    context$2$0.next = 18;
                                    break;
                                }

                                throw new errors.UnknownError('Timed out waiting for screenshot file');

                            case 18:
                                context$2$0.next = 20;
                                return _regeneratorRuntime.awrap(this.getOrientation());

                            case 20:
                                context$2$0.t0 = context$2$0.sent;

                                if (!(context$2$0.t0 === 'LANDSCAPE')) {
                                    context$2$0.next = 25;
                                    break;
                                }

                                logger.debug('Rotating landscape screenshot');
                                context$2$0.next = 25;
                                return _regeneratorRuntime.awrap(_appiumIosDriverNode_modulesAppiumUiauto.utils.rotateImage(shotPath, -90));

                            case 25:

                                ncp(shotFolder, temp, function (err) {
                                    if (err) {
                                        return logger.error(err);
                                    }
                                    logger.log('screenshot done!');
                                });

                                return context$2$0.abrupt('return');

                            case 27:
                            case 'end':
                                return context$2$0.stop();
                        }
                    }, null, _this);
                };

            case 13:
            case 'end':
                return context$1$0.stop();
        }
    }, null, this);
};

module.exports = testwa;

//Android device

//IOS device

//only difference between ios and android is not getting performance.

// check the rotation, and rotate if necessary
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYlxcdGVzdHdhXFx0ZXN0d2EuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7NEJBRzBCLGVBQWU7O29CQUN4QixNQUFNOzs7O3NCQUNOLFNBQVM7Ozs7dURBQ0osMERBQTBEOzt3QkFDMUQsVUFBVTs7QUFFaEMsSUFBSSxNQUFNLEdBQUcsNkJBQVUsUUFBUSxDQUFDLENBQUM7QUFDakMsSUFBSSxPQUFPLEdBQUcsNkJBQVUsWUFBWSxDQUFDLENBQUM7O0FBRXRDLElBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDakIsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7SUFDdEIsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUM7SUFDMUIsY0FBYyxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztJQUMzQyxRQUFRLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0lBQ3ZDLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDO0lBQ3hCLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRztJQUN4QixXQUFXLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDOztBQUUxQyxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFDaEIsSUFBSSxXQUFXLEdBQUMsQ0FBQyxDQUFDO0FBQ2xCLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztBQUNqQixJQUFJLFVBQVUsR0FBRyxHQUFHLENBQUM7QUFDckIsSUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDO0FBQ2xCLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztBQUNyQixJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7QUFDbkIsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0FBQ2xCLElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztBQUNwQixJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7QUFDbEIsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDOztBQUVwQixNQUFNLENBQUMsU0FBUyxHQUFHLFVBQVUsSUFBSSxFQUFFO0FBQy9CLFFBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtBQUNsQixZQUFJLFlBQVksR0FBRyxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUMsQ0FBQzs7QUFFL0IsWUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO0FBQ1gsMEJBQWMsQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDMUYsTUFDSTtBQUNELDBCQUFjLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3BHO0tBQ0o7Q0FDSixDQUFBOztBQUVELE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxVQUFVLE1BQU0sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFO0FBQ3hGLFFBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7O0FBRXZCLFFBQUksYUFBYSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdEMsaUJBQWEsQ0FBQyxRQUFRLENBQUMsV0FBVyxHQUFHLGlGQUFpRixDQUFDO0FBQ3ZILFFBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTs7QUFFZCxlQUFPLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0tBQ2hDLE1BQU07QUFDSCxzQkFBYyxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtLQUMzRDtDQUNKLENBQUE7O0FBRUQsTUFBTSxDQUFDLHFCQUFxQixHQUFHLFVBQVUsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUU7QUFDN0YsUUFBSSxhQUFhLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN0QyxpQkFBYSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBQ2xDLGlCQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDO0FBQ2pELGlCQUFhLENBQUMsUUFBUSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7QUFDbkMsaUJBQWEsQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUM7QUFDekQsaUJBQWEsQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztBQUMzQyxpQkFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0FBQzNDLGlCQUFhLENBQUMsUUFBUSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7QUFDL0MsaUJBQWEsQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLEVBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFDLENBQUM7QUFDbEUsaUJBQWEsQ0FBQyxRQUFRLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQzs7QUFFM0MsUUFBSSxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztBQUN4QixRQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDL0IsaUJBQWEsQ0FBQyxPQUFPLEdBQUcsT0FBTyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDM0QsaUJBQWEsQ0FBQyxNQUFNLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQztBQUMxQyxRQUFJLElBQUksS0FBSyxXQUFXLENBQUMsS0FBSyxFQUFFO0FBQzVCLHFCQUFhLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztLQUMxRjs7QUFHRCxRQUFJLE9BQU8sRUFBRTs7QUFFVCxlQUFPLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0tBQ2hDLE1BQU07QUFDSCxzQkFBYyxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUM1RDtDQUNKLENBQUE7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxvQkFBZ0IsTUFBTSxFQUFDLEdBQUcsRUFBQyxVQUFVLEVBQUMsV0FBVyxFQUFDLE9BQU8sRUFBQyxPQUFPOzs7O3NCQUMxRSxPQUFPLEtBQUssZUFBZSxDQUFBOzs7OztxQkFDdkIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDOzs7OztzQkFDbEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksS0FBSyxlQUFlLENBQUE7Ozs7OztpREFFckUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDOzs7Ozs7OztpREFJL0UsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQzs7Ozs7Ozs7QUFJckYsc0JBQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDOzs7Ozs7OztBQUlwRixzQkFBTSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sRUFBQyxHQUFHLEVBQUMsVUFBVSxFQUFDLFdBQVcsRUFBQyxPQUFPLEVBQUMsT0FBTyxDQUFDLENBQUM7Ozs7Ozs7Q0FFdkYsQ0FBQTs7O0FBR0QsTUFBTSxDQUFDLG9CQUFvQixHQUFHLFVBQVUsT0FBTyxFQUFFLE9BQU8sRUFBRTtBQUN0RCxRQUFJLE9BQU8sS0FBSyxlQUFlLEVBQUU7QUFDN0IsZUFBTyxDQUFDLE1BQU0sRUFBQyxFQUFFLENBQUMsQ0FBQztLQUN0QixNQUFNLElBQUksT0FBTyxLQUFLLGNBQWMsRUFBRTtBQUNuQyxlQUFPLENBQUMsT0FBTyxHQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUMsR0FBRyxFQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUNwRCxNQUFNLElBQUcsT0FBTyxLQUFLLGFBQWEsRUFBRTtBQUNqQyxlQUFPLENBQUMsT0FBTyxHQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUMsR0FBRyxFQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUNwRCxNQUFNLElBQUksT0FBTyxLQUFLLE9BQU8sRUFBRTtBQUM1QixlQUFPLENBQUMsSUFBSSxFQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ3BCLE1BQU0sSUFBSSxPQUFPLEtBQUssVUFBVSxFQUFFO0FBQy9CLGVBQU8sQ0FBQyxJQUFJLEVBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUN4QyxNQUFNLElBQUksT0FBTyxLQUFLLGNBQWMsRUFBRTtBQUNuQyxlQUFPLENBQUMsSUFBSSxFQUFDLE9BQU8sQ0FBQyxFQUFFLEdBQUMsSUFBSSxDQUFDLENBQUM7S0FDakMsTUFBTSxJQUFJLE9BQU8sS0FBSyxlQUFlLEVBQUU7QUFDcEMsZUFBTyxDQUFDLFFBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQztLQUN4QixNQUFNLElBQUksT0FBTyxLQUFLLGNBQWMsRUFBRTtBQUNuQyxZQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtBQUM5QixnQkFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoQyxnQkFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLFdBQVcsRUFBRTtBQUMvQixvQkFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUM3Qix1QkFBTyxDQUFDLElBQUksRUFBQyxLQUFLLEdBQUMsT0FBTyxDQUFDLENBQUMsR0FBQyxLQUFLLEdBQUMsT0FBTyxDQUFDLENBQUMsR0FBQyxHQUFHLEdBQUMsT0FBTyxDQUFDLFFBQVEsR0FBQyxJQUFJLENBQUMsQ0FBQzthQUMzRTtTQUNKLE1BQU0sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7QUFDckMsZ0JBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakMsZ0JBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakMsZ0JBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxRQUFRLEVBQUU7QUFDM0Qsb0JBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7QUFDL0Isb0JBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7QUFDL0IsdUJBQU8sQ0FBQyxJQUFJLEVBQUMsTUFBTSxHQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUMsS0FBSyxHQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUMsT0FBTyxHQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUMsS0FBSyxHQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUMsR0FBRyxDQUFDLENBQUM7YUFDNUY7U0FDSjtLQUNKOztBQUVELFdBQU8sQ0FBQyxPQUFPLEVBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0NBQ2xDLENBQUE7QUFDRCxNQUFNLENBQUMsTUFBTSxHQUFHLFVBQVUsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFDLE1BQU0sRUFBQyxLQUFLLEVBQUMsT0FBTyxFQUFDLFVBQVUsRUFBRTtBQUM1RixRQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNwRCxRQUFJLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ3ZCLFFBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7O0FBRXZCLFFBQUksYUFBYSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdEMsaUJBQWEsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQztBQUMzQyxpQkFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQztBQUNqRCxpQkFBYSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQ25DLGlCQUFhLENBQUMsUUFBUSxDQUFDLE9BQU8sR0FBRyxPQUFPLEdBQUcsT0FBTyxHQUFDLEdBQUcsQ0FBQztBQUN2RCxpQkFBYSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsVUFBVSxHQUFHLFVBQVUsR0FBQyxHQUFHLENBQUM7QUFDNUQsaUJBQWEsQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUM7QUFDekQsaUJBQWEsQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLFFBQVEsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7QUFDekUsaUJBQWEsQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLFFBQVEsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7QUFDdkUsaUJBQWEsQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLFVBQVUsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7QUFDN0UsaUJBQWEsQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLEVBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFDLENBQUM7O0FBRXJFLFFBQUksTUFBTSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7QUFDeEIsUUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQy9CLGlCQUFhLENBQUMsUUFBUSxDQUFDLE9BQU8sR0FBRyxPQUFPLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUNwRSxpQkFBYSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQztBQUNuRCxRQUFJLElBQUksS0FBSyxXQUFXLENBQUMsS0FBSyxFQUFFO0FBQzVCLHFCQUFhLENBQUMsUUFBUSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7S0FDbkc7O0FBRUQsV0FBTyxDQUFDLGFBQWEsRUFBQyxPQUFPLENBQUMsQ0FBQztDQUNsQyxDQUFBO0FBQ0QsTUFBTSxDQUFDLGdCQUFnQixHQUFHLG9CQUFlLE1BQU0sRUFBQyxHQUFHLEVBQUMsVUFBVSxFQUFDLFdBQVcsRUFBQyxPQUFPLEVBQUMsT0FBTztRQUNsRixNQUFNLEVBQ04sSUFBSSxFQUNKLElBQUksaURBS0gsTUFBTSxFQUFDLEtBQUssZUFFWixVQUFVLEVBQUMsT0FBTyxtQ0FFbEIsYUFBYSxFQUFDLE9BQU8sRUFFdEIsY0FBYyxFQUNkLE9BQU87Ozs7O0FBZFAsc0JBQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUM7QUFDL0Msb0JBQUksR0FBRyxNQUFNLENBQUMsSUFBSTtBQUNsQixvQkFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJOztBQUN0Qix1QkFBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7Ozs7d0NBSUYsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sRUFBQyxPQUFPLENBQUM7O0FBQTFELHNCQUFNO0FBQUMscUJBQUs7O2lEQUVnQixJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBQyxXQUFXLENBQUM7Ozs7O0FBQW5FLDBCQUFVO0FBQUMsdUJBQU87aUNBRU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUMsR0FBRyxFQUFDLFVBQVUsRUFBQyxXQUFXLEVBQUMsTUFBTSxFQUFDLEtBQUssRUFBQyxPQUFPLEVBQUMsVUFBVSxDQUFDOztBQUF6Ryw2QkFBYTtBQUFDLHVCQUFPO0FBRXRCLDhCQUFjLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLEdBQUMsRUFBRTtBQUM5Qyx1QkFBTyxHQUFHLGNBQWMsR0FBQyxPQUFPLEdBQUMsTUFBTTs7aURBQ3JDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUMsT0FBTyxDQUFDOzs7QUFDakQsNkJBQWEsQ0FBQyxRQUFRLENBQUMsY0FBYyxHQUFHLE9BQU8sR0FBQyxNQUFNLENBQUM7O0FBRXZELG9CQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7O0FBRWQsMkJBQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7aUJBQ2hDLE1BQU07QUFDSCxrQ0FBYyxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDNUQ7Ozs7Ozs7Q0FDSixDQUFDOztBQUVGLE1BQU0sQ0FBQyxZQUFZLEdBQUcsb0JBQWdCLE1BQU0sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsT0FBTztRQUVwRixNQUFNLEVBQ04sSUFBSSxFQUNKLElBQUksbURBR0gsTUFBTSxFQUFDLEtBQUsscUNBRVosYUFBYSxFQUFDLE9BQU8sRUFFdEIsY0FBYyxFQUNkLE9BQU87Ozs7O0FBVlAsc0JBQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUM7QUFDL0Msb0JBQUksR0FBRyxNQUFNLENBQUMsSUFBSTtBQUNsQixvQkFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJOztBQUN0Qix1QkFBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7O3lDQUVGLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLEVBQUMsT0FBTyxDQUFDOztBQUExRCxzQkFBTTtBQUFDLHFCQUFLO2tDQUVhLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFDLFVBQVUsRUFBQyxXQUFXLEVBQUMsTUFBTSxFQUFDLEtBQUssRUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDOztBQUF0Riw2QkFBYTtBQUFDLHVCQUFPO0FBRXRCLDhCQUFjLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLEdBQUMsRUFBRTtBQUM5Qyx1QkFBTyxHQUFHLGNBQWMsR0FBQyxPQUFPLEdBQUMsTUFBTTs7aURBQ3JDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUMsT0FBTyxDQUFDOzs7QUFDN0MsNkJBQWEsQ0FBQyxRQUFRLENBQUMsY0FBYyxHQUFHLE9BQU8sR0FBQyxNQUFNLENBQUM7O0FBRXZELG9CQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7O0FBRWQsMkJBQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7aUJBQ2hDLE1BQU07QUFDSCxrQ0FBYyxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDNUQ7Ozs7Ozs7Q0FDSixDQUFBOzs7QUFHRCxNQUFNLENBQUMsY0FBYyxHQUFHLG9CQUFnQixhQUFhLEVBQUMsV0FBVztRQUV6RCxHQUFHLEVBQ0gsSUFBSSxFQUNKLE9BQU8sRUFDUCxHQUFHLEVBQ0gsT0FBTyxFQUNQLE9BQU8sRUFDUCxRQUFRLEVBQ1IsVUFBVSxFQUNWLFVBQVUsRUFFVixPQUFPOzs7O0FBWFgsc0JBQU0sQ0FBQyxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztBQUNqRCxtQkFBRyxHQUFHLGFBQWEsQ0FBQyxHQUFHO0FBQ3ZCLG9CQUFJLEdBQUcsYUFBYSxDQUFDLElBQUk7QUFDekIsdUJBQU8sR0FBRyxJQUFJLENBQUMsVUFBVTs7aURBQ2IsR0FBRyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsR0FBQyxPQUFPLENBQUM7OztBQUF4RCxtQkFBRztBQUNILHVCQUFPLEdBQUcsa0JBQWtCO0FBQzVCLHVCQUFPLEdBQUcsa0JBQWtCO0FBQzVCLHdCQUFRLEdBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUM7QUFDOUIsMEJBQVUsR0FBSSxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQztBQUNoQywwQkFBVSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUM7O0FBQzVCLDBCQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUMsRUFBRSxDQUFDLENBQUM7QUFDcEMsdUJBQU8sR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDOztBQUMzQix1QkFBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFDLEVBQUUsQ0FBQyxDQUFDO29EQUMzQixDQUFDLFVBQVUsRUFBQyxPQUFPLENBQUM7Ozs7Ozs7Q0FDOUIsQ0FBQzs7QUFFRixNQUFNLENBQUMsb0JBQW9CLEdBQUcsb0JBQWdCLGFBQWEsRUFBRSxPQUFPO1FBQzFELEdBQUcsRUFDTCxHQUFHOzs7O0FBREQsbUJBQUcsR0FBRyxnQ0FBZ0M7QUFDeEMsbUJBQUcsR0FBSSxDQUFDLGdCQUFnQixFQUFLLEdBQUcsUUFBSyx1QkFBdUIsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDOztpREFDdEUsYUFBYSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDOzs7O2lEQUN4QixFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQzs7Ozs7Ozs7O2lEQUNsQixFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQzs7OztpREFFdEIsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQzs7Ozs7OztDQUM3QyxDQUFBOztBQUVELE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxvQkFBZ0IsTUFBTSxFQUFFLE9BQU87UUFDakQsSUFBSSxFQUNKLFFBQVEsRUFFUixVQUFVLEVBTVYsUUFBUSxFQUdSLGNBQWM7Ozs7OztBQVpkLG9CQUFJLEdBQUcsb0JBQUssTUFBTSxFQUFFO0FBQ3BCLHdCQUFRLGtCQUFnQixJQUFJO0FBRTVCLDBCQUFVLEdBQUcsZ0NBQWdDLEdBQUMsUUFBUSxHQUFDLE1BQU07QUFBQyxpQkFBQzs7aURBQ3ZELEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDOzs7Ozs7OztBQUM3QixzQkFBTSxDQUFDLEtBQUssd0JBQXFCLFVBQVUsUUFBSSxDQUFDOztpREFDMUMsTUFBTSxDQUFDLFVBQVUsQ0FBQzs7O0FBR3hCLHdCQUFRLEdBQUcsa0JBQUssT0FBTyxDQUFDLFVBQVUsRUFBSyxRQUFRLFVBQU87O0FBQzFELHNCQUFNLENBQUMsS0FBSywyQkFBd0IsUUFBUSxRQUFJLENBQUM7O0FBRTdDLDhCQUFjLEdBQUcsU0FBakIsY0FBYzt3QkFHVixxQkFBcUIsRUFFckIsT0FBTyxFQUVQLE9BQU87Ozs7O2lFQU5MLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxtQkFBZ0IsUUFBUSxTQUFLOzs7QUFFNUQscURBQXFCLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixJQUFJLEVBQUUsQ0FBQSxHQUFJLElBQUk7O0FBQzFFLHNDQUFNLENBQUMsS0FBSyxjQUFZLHFCQUFxQix5Q0FBc0MsQ0FBQztBQUNoRix1Q0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUU7QUFFcEIsdUNBQU8sR0FBRyxLQUFLOzs7c0NBQ1osQUFBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsT0FBTyxHQUFJLHFCQUFxQixDQUFBOzs7Ozs7aUVBQ3ZDLEVBQUUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDOzs7Ozs7OztBQUM1Qix1Q0FBTyxHQUFHLElBQUksQ0FBQzs7Ozs7aUVBR2IsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7Ozs7Ozs7b0NBRWpCLE9BQU87Ozs7O3NDQUNGLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyx1Q0FBdUMsQ0FBQzs7OztpRUFJaEUsSUFBSSxDQUFDLGNBQWMsRUFBRTs7Ozs7eURBQUssV0FBVzs7Ozs7QUFDM0Msc0NBQU0sQ0FBQyxLQUFLLENBQUMsK0JBQStCLENBQUMsQ0FBQzs7aUVBQ3hDLCtDQUFNLFdBQVcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUM7Ozs7QUFHMUMsbUNBQUcsQ0FBQyxVQUFVLEVBQUMsSUFBSSxFQUFDLFVBQVUsR0FBRyxFQUFFO0FBQy9CLHdDQUFJLEdBQUcsRUFBRTtBQUNMLCtDQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7cUNBQzVCO0FBQ0QsMENBQU0sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztpQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7OztpQkFHekM7Ozs7Ozs7Q0FDSixDQUFBOztBQUVELE1BQU0sQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDIiwiZmlsZSI6ImxpYlxcdGVzdHdhXFx0ZXN0d2EuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLy8gdHJhbnNwaWxlOnRlc3R3YVxyXG5cclxuaW1wb3J0IHsgZ2V0TG9nZ2VyIH0gZnJvbSAnYXBwaXVtLWxvZ2dlcic7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgdXVpZCBmcm9tICd1dWlkLWpzJztcclxuaW1wb3J0IHsgdXRpbHMgfSBmcm9tICcuLi8uLi8uLi8uLi9hcHBpdW0taW9zLWRyaXZlci9ub2RlX21vZHVsZXMvYXBwaXVtLXVpYXV0byc7XHJcbmltcG9ydCB7IHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xyXG5cclxubGV0IGxvZ2dlciA9IGdldExvZ2dlcihcIlRlc3RXYVwiKTtcclxubGV0IGxvZ0RhdGEgPSBnZXRMb2dnZXIoXCJUZXN0V2FEYXRhXCIpO1xyXG5cclxubGV0ICBmcyA9IHJlcXVpcmUoJ2ZzJylcclxuICAgICwgdGVtcCA9IHJlcXVpcmUoJ3RlbXAnKVxyXG4gICAgLCBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpXHJcbiAgICAsdGVzdHdhcmVzcG9uc2UgPSByZXF1aXJlKCcuL21pZGRsZXdhcmUuanMnKVxyXG4gICAgLHRlc3REYXRhID0gcmVxdWlyZSgnLi90ZXN0Y2FzZWRhdGEuanMnKVxyXG4gICAgLGFzeW5jID0gcmVxdWlyZSgnYXN5bmMnKVxyXG4gICAgLG5jcCA9IHJlcXVpcmUoJ25jcCcpLm5jcFxyXG4gICAgLHF1ZXJ5c3RyaW5nID0gcmVxdWlyZShcInF1ZXJ5c3RyaW5nXCIpOy8vdGVzdHdhXHJcblxyXG5sZXQgdGVzdHdhID0ge307XHJcbmxldCBzY3JlZW5JbmRleD0wO1xyXG5sZXQgb3BfYWx1ZSA9IFwiXCI7XHJcbmxldCBtZW1vcnlpbmZvID0gXCIwXCI7XHJcbmxldCBjcHVyYXRlID0gXCIwXCI7XHJcbmxldCBwYWNrYWdlbmFtZSA9IFwiXCI7XHJcbmxldCBzZXNzaW9uaWQgPSBcIlwiO1xyXG5sZXQgdGVzdHN1aXQgPSBcIlwiO1xyXG5sZXQgdGVzdGNhc2VpZCA9IFwiXCI7XHJcbmxldCBkZXZpY2VpZCA9IFwiXCI7XHJcbmxldCBnZW5Ub29sID0gZmFsc2U7XHJcblxyXG50ZXN0d2EuaGVhcnRiZWF0ID0gZnVuY3Rpb24gKGFyZ3MpIHtcclxuICAgIGlmIChhcmdzLndhSGVhcnRiZWF0KSB7XHJcbiAgICAgICAgdmFyIHJldHVyblN0YXR1cyA9IHtzdGF0dXM6IDB9O1xyXG4gICAgICAgIC8vdXNlIHRlc3R3YURldmljZUlkIGluc3RlYWQgb2YgdWRpZCBmb3IgTUFDXHJcbiAgICAgICAgaWYgKGFyZ3MudWRpZCkge1xyXG4gICAgICAgICAgICB0ZXN0d2FyZXNwb25zZS5TZW5kU3RhcnRTdGF0dXMocmV0dXJuU3RhdHVzLCBhcmdzLnVkaWQsIGFyZ3MudGVzdGNhc2Vsb2dJZCwgYXJncy5wb3J0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRlc3R3YXJlc3BvbnNlLlNlbmRTdGFydFN0YXR1cyhyZXR1cm5TdGF0dXMsIGFyZ3MudGVzdHdhRGV2aWNlSWQsIGFyZ3MudGVzdGNhc2Vsb2dJZCwgYXJncy5wb3J0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbnRlc3R3YS5yZXNwb25zZU5vRHJpdmVyID0gZnVuY3Rpb24gKGRyaXZlciwgcmVxLCBodHRwU3RhdHVzLCBodHRwUmVzQm9keSwgY29tbW9uZCwganNvbk9iaikge1xyXG4gICAgbGV0IGFyZ3MgPSBkcml2ZXIuYXJncztcclxuXHJcbiAgICBsZXQgdGVzdERhdGFSZXBseSA9IF8uY2xvbmUodGVzdERhdGEpO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5kZXNjcmlwdGlvbiA9IFwiTm8gRHJpdmVyIGZvdW5kIGZvciB0aGlzIHNlc3Npb24sIHByb2JhYmx5IGFwcGl1bSBlcnJvciwgcGxlYXNlIHJlc3RhcnQgYXBwaXVtIVwiO1xyXG4gICAgaWYgKGFyZ3MuZ2VuVG9vbCkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRlc3REYXRhUmVwbHkpO1xyXG4gICAgICAgIGxvZ0RhdGEuZXJyb3IodGVzdERhdGFSZXBseSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRlc3R3YXJlc3BvbnNlLlNlbmREYXRhTmF0aXZlQXBwKHRlc3REYXRhUmVwbHkudGVzdGRhdGEpXHJcbiAgICB9XHJcbn1cclxuXHJcbnRlc3R3YS5yZXNwb25zZURlbGV0ZVNlc3Npb24gPSBmdW5jdGlvbiAoZHJpdmVyLCByZXEsIGh0dHBTdGF0dXMsIGh0dHBSZXNCb2R5LCBjb21tb25kLCBqc29uT2JqKSB7XHJcbiAgICBsZXQgdGVzdERhdGFSZXBseSA9IF8uY2xvbmUodGVzdERhdGEpO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5zdGF0dXMgPSAwO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS52YWx1ZSA9IGh0dHBSZXNCb2R5LnZhbHVlO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5ydW50aW1lID0gMDtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuc2Vzc2lvbklkID0gaHR0cFJlc0JvZHkuc2Vzc2lvbklkO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5kZXZpY2VJZCA9IGRldmljZWlkO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS50ZXN0U3VpdCA9IHRlc3RzdWl0O1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS50ZXN0Y2FzZUlkID0gdGVzdGNhc2VpZDtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuY29tbWFuZCA9IHtcImFjdGlvblwiOiBcIuWBnOatoua1i+ivlVwiLCBcInBhcmFtc1wiOiBcIlwifTtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuc2NyZWVuc2hvdFBhdGggPSBcIlwiO1xyXG5cclxuICAgIGxldCBteURhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgbGV0IGVuZFRpbWUgPSBteURhdGUuZ2V0VGltZSgpO1xyXG4gICAgdGVzdERhdGFSZXBseS5ydW50aW1lID0gZW5kVGltZSAtIHJlcS5fc3RhcnRUaW1lLmdldFRpbWUoKTtcclxuICAgIHRlc3REYXRhUmVwbHkuc3RhdHVzID0gaHR0cFJlc0JvZHkuc3RhdHVzO1xyXG4gICAgaWYgKG51bGwgIT09IGh0dHBSZXNCb2R5LnZhbHVlKSB7XHJcbiAgICAgICAgdGVzdERhdGFSZXBseS5kZXNjcmlwdGlvbiA9IGh0dHBSZXNCb2R5LnZhbHVlLm1lc3NhZ2UgPyBodHRwUmVzQm9keS52YWx1ZS5tZXNzYWdlIDogXCJcIjtcclxuICAgIH1cclxuXHJcblxyXG4gICAgaWYgKGdlblRvb2wpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZXN0RGF0YVJlcGx5KTtcclxuICAgICAgICBsb2dEYXRhLmVycm9yKHRlc3REYXRhUmVwbHkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0ZXN0d2FyZXNwb25zZS5TZW5kRGF0YU5hdGl2ZUFwcCh0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhKTtcclxuICAgIH1cclxufVxyXG5cclxudGVzdHdhLmhhbmRsZXIgPSBhc3luYyBmdW5jdGlvbiAoZHJpdmVyLHJlcSxodHRwU3RhdHVzLGh0dHBSZXNCb2R5LGNvbW1vbmQsanNvbk9iaikge1xyXG4gICAgaWYgKGNvbW1vbmQgIT09ICdkZWxldGVTZXNzaW9uJykge1xyXG4gICAgICAgIGlmIChkcml2ZXIuc2Vzc2lvbnNbaHR0cFJlc0JvZHkuc2Vzc2lvbklkXSkge1xyXG4gICAgICAgICAgICBpZiAoZHJpdmVyLnNlc3Npb25zW2h0dHBSZXNCb2R5LnNlc3Npb25JZF0uY29uc3RydWN0b3IubmFtZSA9PT0gJ0FuZHJvaWREcml2ZXInKSB7XHJcbiAgICAgICAgICAgICAgICAvL0FuZHJvaWQgZGV2aWNlXHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0ZXN0d2EuZ2V0QWN0aW9uQW5kcm9pZChkcml2ZXIsIHJlcSwgaHR0cFN0YXR1cywgaHR0cFJlc0JvZHksIGNvbW1vbmQsIGpzb25PYmopO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9JT1MgZGV2aWNlXHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0ZXN0d2EuZ2V0QWN0aW9uSU9TKGRyaXZlciwgcmVxLCBodHRwU3RhdHVzLCBodHRwUmVzQm9keSwgY29tbW9uZCwganNvbk9iaik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL25vIGRyaXZlciBmb3VuZCAsIHJlc3BvbnNlIGVycm9yXHJcbiAgICAgICAgICAgIHRlc3R3YS5yZXNwb25zZU5vRHJpdmVyKGRyaXZlciwgcmVxLCBodHRwU3RhdHVzLCBodHRwUmVzQm9keSwgY29tbW9uZCwganNvbk9iaik7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAvL2RlbGV0ZVNlc3Npb25cclxuICAgICAgICB0ZXN0d2EucmVzcG9uc2VEZWxldGVTZXNzaW9uKGRyaXZlcixyZXEsaHR0cFN0YXR1cyxodHRwUmVzQm9keSxjb21tb25kLGpzb25PYmopO1xyXG4gICAgfVxyXG59XHJcblxyXG4vL0FuZHJvaWQgZHJpdmVyXHJcbnRlc3R3YS5nZXRUcmFuc2xhdGlvbkFjdGlvbiA9IGZ1bmN0aW9uIChjb21tb25kLCBqc29uT2JqKSB7XHJcbiAgICBpZiAoY29tbW9uZCA9PT0gXCJjcmVhdGVTZXNzaW9uXCIpIHtcclxuICAgICAgICByZXR1cm4gW1wi5Yib5bu65Lya6K+dXCIsXCJcIl07XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1vbmQgPT09IFwiZmluZEVsZW1lbnRzXCIpIHtcclxuICAgICAgICByZXR1cm4gW1wi5p+l5om+5YWD57Sg77yIXCIranNvbk9iai51c2luZytcIu+8iVwiLGpzb25PYmoudmFsdWVdO1xyXG4gICAgfSBlbHNlIGlmKGNvbW1vbmQgPT09IFwiZmluZEVsZW1lbnRcIikge1xyXG4gICAgICAgIHJldHVybiBbXCLmn6Xmib7lhYPntKDvvIhcIitqc29uT2JqLnVzaW5nK1wi77yJXCIsanNvbk9iai52YWx1ZV07XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1vbmQgPT09IFwiY2xpY2tcIikge1xyXG4gICAgICAgIHJldHVybiBbXCLngrnlh7tcIixcIlwiXTtcclxuICAgIH0gZWxzZSBpZiAoY29tbW9uZCA9PT0gXCJzZXRWYWx1ZVwiKSB7XHJcbiAgICAgICAgcmV0dXJuIFtcIui+k+WFpVwiLGpzb25PYmoudmFsdWUuam9pbihcIlwiKV07XHJcbiAgICB9IGVsc2UgaWYgKGNvbW1vbmQgPT09IFwiaW1wbGljaXRXYWl0XCIpIHtcclxuICAgICAgICByZXR1cm4gW1wi562J5b6FXCIsanNvbk9iai5tcytcIm1zXCJdO1xyXG4gICAgfSBlbHNlIGlmIChjb21tb25kID09PSBcImdldFdpbmRvd1NpemVcIikge1xyXG4gICAgICAgIHJldHVybiBbXCLojrflj5blsY/luZXlpKflsI9cIixcIlwiXTtcclxuICAgIH0gZWxzZSBpZiAoY29tbW9uZCA9PT0gXCJwZXJmb3JtVG91Y2hcIikge1xyXG4gICAgICAgIGlmIChqc29uT2JqLmFjdGlvbnMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgIGxldCBhY3Rpb24gPSBqc29uT2JqLmFjdGlvbnNbMF07XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24uYWN0aW9uID09PSBcImxvbmdQcmVzc1wiKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb3B0aW9ucyA9IGFjdGlvbi5vcHRpb25zO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcIumVv+aMiVwiLFwiKHg6XCIrb3B0aW9ucy54K1wiLHk6XCIrb3B0aW9ucy55K1wiKVwiK29wdGlvbnMuZHVyYXRpb24rXCJtc1wiXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoanNvbk9iai5hY3Rpb25zLmxlbmd0aCA9PT0gNCkge1xyXG4gICAgICAgICAgICBsZXQgYWN0aW9uMSA9IGpzb25PYmouYWN0aW9uc1swXTtcclxuICAgICAgICAgICAgbGV0IGFjdGlvbjMgPSBqc29uT2JqLmFjdGlvbnNbMl07XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24xLmFjdGlvbiA9PT0gXCJwcmVzc1wiICYmIGFjdGlvbjMuYWN0aW9uID09PSBcIm1vdmVUb1wiKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgb3B0aW9uczEgPSBhY3Rpb24xLm9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICBsZXQgb3B0aW9uczMgPSBhY3Rpb24zLm9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW1wi5ruR5bGPXCIsXCLku44oeDpcIitvcHRpb25zMS54K1wiLHk6XCIrb3B0aW9uczEueStcIinliLAoeDpcIitvcHRpb25zMy54K1wiLHk6XCIrb3B0aW9uczMueStcIilcIl07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFtjb21tb25kLGpzb25PYmoudmFsdWVdO1xyXG59XHJcbnRlc3R3YS5nZW5Sc3AgPSBmdW5jdGlvbiAoZHJpdmVyLCByZXEsIGh0dHBTdGF0dXMsIGh0dHBSZXNCb2R5LGFjdGlvbixwYXJhbSxjcHVSYXRlLG1lbW9yeUluZm8pIHtcclxuICAgIGxldCBEcml2ZXIgPSBkcml2ZXIuc2Vzc2lvbnNbaHR0cFJlc0JvZHkuc2Vzc2lvbklkXTtcclxuICAgIGxldCBjYXBzID0gRHJpdmVyLmNhcHM7XHJcbiAgICBsZXQgYXJncyA9IGRyaXZlci5hcmdzO1xyXG5cclxuICAgIGxldCB0ZXN0RGF0YVJlcGx5ID0gXy5jbG9uZSh0ZXN0RGF0YSk7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnN0YXR1cyA9IGh0dHBTdGF0dXM7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnZhbHVlID0gaHR0cFJlc0JvZHkudmFsdWU7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnJ1bnRpbWUgPSAwO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5jcHVyYXRlID0gY3B1UmF0ZSA/IGNwdVJhdGU6XCIwXCI7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLm1lbW9yeSA9IG1lbW9yeUluZm8gPyBtZW1vcnlJbmZvOlwiMFwiO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5zZXNzaW9uSWQgPSBodHRwUmVzQm9keS5zZXNzaW9uSWQ7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLmRldmljZUlkID0gZGV2aWNlaWQgPSBjYXBzID8gY2Fwcy5kZXZpY2VOYW1lIDogXCJcIjtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEudGVzdFN1aXQgPSB0ZXN0c3VpdCA9IGNhcHMgPyBjYXBzLnRlc3RTdWl0IDogXCJcIjtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEudGVzdGNhc2VJZCA9IHRlc3RjYXNlaWQgPSBjYXBzID8gY2Fwcy50ZXN0Y2FzZUlkIDogXCJcIjtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuY29tbWFuZCA9IHtcImFjdGlvblwiOiBhY3Rpb24sIFwicGFyYW1zXCI6IHBhcmFtfTtcclxuXHJcbiAgICBsZXQgbXlEYXRlID0gbmV3IERhdGUoKTtcclxuICAgIGxldCBlbmRUaW1lID0gbXlEYXRlLmdldFRpbWUoKTtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEucnVudGltZSA9IGVuZFRpbWUgLSByZXEuX3N0YXJ0VGltZS5nZXRUaW1lKCk7XHJcbiAgICB0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhLnN0YXR1cyA9IGh0dHBSZXNCb2R5LnN0YXR1cztcclxuICAgIGlmIChudWxsICE9PSBodHRwUmVzQm9keS52YWx1ZSkge1xyXG4gICAgICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuZGVzY3JpcHRpb24gPSBodHRwUmVzQm9keS52YWx1ZS5tZXNzYWdlID8gaHR0cFJlc0JvZHkudmFsdWUubWVzc2FnZSA6IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFt0ZXN0RGF0YVJlcGx5LGVuZFRpbWVdO1xyXG59XHJcbnRlc3R3YS5nZXRBY3Rpb25BbmRyb2lkID0gYXN5bmMgZnVuY3Rpb24oZHJpdmVyLHJlcSxodHRwU3RhdHVzLGh0dHBSZXNCb2R5LGNvbW1vbmQsanNvbk9iail7XHJcbiAgICBsZXQgRHJpdmVyID0gZHJpdmVyLnNlc3Npb25zW2h0dHBSZXNCb2R5LnNlc3Npb25JZF07XHJcbiAgICBsZXQgY2FwcyA9IERyaXZlci5jYXBzO1xyXG4gICAgbGV0IGFyZ3MgPSBkcml2ZXIuYXJncztcclxuICAgIGdlblRvb2wgPSBhcmdzLmdlblRvb2w7XHJcbiAgICAvLyBsZXQgYWN0aW9uID0gY29tbW9uZDtcclxuICAgIC8vIGxldCBwYXJhbSA9IGpzb25PYmoudmFsdWUgPyBqc29uT2JqLnZhbHVlOmpzb25PYmoubXM7XHJcblxyXG4gICAgbGV0IFthY3Rpb24scGFyYW1dID0gdGhpcy5nZXRUcmFuc2xhdGlvbkFjdGlvbihjb21tb25kLGpzb25PYmopO1xyXG5cclxuICAgIGxldCBbbWVtb3J5SW5mbyxjcHVSYXRlXSA9IGF3YWl0IHRoaXMuZ2V0UGVyZm9ybWFuY2UoRHJpdmVyLGh0dHBSZXNCb2R5KTtcclxuXHJcbiAgICBsZXQgW3Rlc3REYXRhUmVwbHksZW5kVGltZV0gPSB0ZXN0d2EuZ2VuUnNwKGRyaXZlcixyZXEsaHR0cFN0YXR1cyxodHRwUmVzQm9keSxhY3Rpb24scGFyYW0sY3B1UmF0ZSxtZW1vcnlJbmZvKTtcclxuXHJcbiAgICBsZXQgc2NyZWVuc2hvdFBhdGggPSBhcmdzID8gYXJncy5zY3JlZW5zaG90UGF0aDpcIlwiO1xyXG4gICAgbGV0IHRlbXBQbmcgPSBzY3JlZW5zaG90UGF0aCtlbmRUaW1lK1wiLnBuZ1wiO1xyXG4gICAgYXdhaXQgdGVzdHdhLmdldFNjcmVlbnNob3RBbmRyb2lkKERyaXZlcix0ZW1wUG5nKTtcclxuICAgIHRlc3REYXRhUmVwbHkudGVzdGRhdGEuc2NyZWVuc2hvdFBhdGggPSBlbmRUaW1lK1wiLnBuZ1wiO1xyXG5cclxuICAgIGlmIChhcmdzLmdlblRvb2wpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZXN0RGF0YVJlcGx5KTtcclxuICAgICAgICBsb2dEYXRhLmVycm9yKHRlc3REYXRhUmVwbHkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0ZXN0d2FyZXNwb25zZS5TZW5kRGF0YU5hdGl2ZUFwcCh0ZXN0RGF0YVJlcGx5LnRlc3RkYXRhKTtcclxuICAgIH1cclxufTtcclxuXHJcbnRlc3R3YS5nZXRBY3Rpb25JT1MgPSBhc3luYyBmdW5jdGlvbiAoZHJpdmVyLCByZXEsIGh0dHBTdGF0dXMsIGh0dHBSZXNCb2R5LCBjb21tb25kLCBqc29uT2JqKSB7XHJcbiAgICAvL29ubHkgZGlmZmVyZW5jZSBiZXR3ZWVuIGlvcyBhbmQgYW5kcm9pZCBpcyBub3QgZ2V0dGluZyBwZXJmb3JtYW5jZS5cclxuICAgIGxldCBEcml2ZXIgPSBkcml2ZXIuc2Vzc2lvbnNbaHR0cFJlc0JvZHkuc2Vzc2lvbklkXTtcclxuICAgIGxldCBjYXBzID0gRHJpdmVyLmNhcHM7XHJcbiAgICBsZXQgYXJncyA9IGRyaXZlci5hcmdzO1xyXG4gICAgZ2VuVG9vbCA9IGFyZ3MuZ2VuVG9vbDtcclxuXHJcbiAgICBsZXQgW2FjdGlvbixwYXJhbV0gPSB0aGlzLmdldFRyYW5zbGF0aW9uQWN0aW9uKGNvbW1vbmQsanNvbk9iaik7XHJcblxyXG4gICAgbGV0IFt0ZXN0RGF0YVJlcGx5LGVuZFRpbWVdID0gdGVzdHdhLmdlblJzcChkcml2ZXIsaHR0cFN0YXR1cyxodHRwUmVzQm9keSxhY3Rpb24scGFyYW0sMCwwKTtcclxuXHJcbiAgICBsZXQgc2NyZWVuc2hvdFBhdGggPSBhcmdzID8gYXJncy5zY3JlZW5zaG90UGF0aDpcIlwiO1xyXG4gICAgbGV0IHRlbXBQbmcgPSBzY3JlZW5zaG90UGF0aCtlbmRUaW1lK1wiLnBuZ1wiO1xyXG4gICAgYXdhaXQgdGVzdHdhLmdldFNjcmVlbnNob3RJT1MoRHJpdmVyLHRlbXBQbmcpO1xyXG4gICAgdGVzdERhdGFSZXBseS50ZXN0ZGF0YS5zY3JlZW5zaG90UGF0aCA9IGVuZFRpbWUrXCIucG5nXCI7XHJcblxyXG4gICAgaWYgKGFyZ3MuZ2VuVG9vbCkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRlc3REYXRhUmVwbHkpO1xyXG4gICAgICAgIGxvZ0RhdGEuZXJyb3IodGVzdERhdGFSZXBseSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRlc3R3YXJlc3BvbnNlLlNlbmREYXRhTmF0aXZlQXBwKHRlc3REYXRhUmVwbHkudGVzdGRhdGEpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vL2dldCBtZW1vcnlpbmZvIGFuZCBjcHVyYXRlXHJcbnRlc3R3YS5nZXRQZXJmb3JtYW5jZSA9IGFzeW5jIGZ1bmN0aW9uIChhbmRyb2lkRHJpdmVyLGh0dHBSZXNCb2R5KSB7XHJcbiAgICBsb2dnZXIuZGVidWcoXCJHZXR0aW5nIGRldmljZSBtZW1lb3J5IGFuZCBjcHUgY29zdCFcIik7XHJcbiAgICBsZXQgYWRiID0gYW5kcm9pZERyaXZlci5hZGI7XHJcbiAgICBsZXQgY2FwcyA9IGFuZHJvaWREcml2ZXIuY2FwcztcclxuICAgIGxldCBhcHBOYW1lID0gY2Fwcy5hcHBQYWNrYWdlO1xyXG4gICAgbGV0IG91dCA9IGF3YWl0IGFkYi5zaGVsbChcInRvcCAtbiAxIC1kIDAuNSB8IGdyZXAgXCIrYXBwTmFtZSk7XHJcbiAgICBsZXQgcmVnX01FTSA9IC9bMC05XXsxLDl9KFtLXSkvZztcclxuICAgIGxldCByZWdfQ1BVID0gL1swLTldezEsMn0oWyVdKS9nO1xyXG4gICAgbGV0IG1lbWFycmF5ICA9IG91dC5tYXRjaChyZWdfTUVNKTtcclxuICAgIGxldCB0bXBjcHVyYXRlICA9IG91dC5tYXRjaChyZWdfQ1BVKTtcclxuICAgIGxldCBtZW1vcnlpbmZvID0gbWVtYXJyYXlbMV07XHJcbiAgICBtZW1vcnlpbmZvID0gbWVtb3J5aW5mby5yZXBsYWNlKCdLJywnJyk7XHJcbiAgICBsZXQgY3B1cmF0ZSA9IHRtcGNwdXJhdGVbMF07XHJcbiAgICBjcHVyYXRlID0gY3B1cmF0ZS5yZXBsYWNlKCclJywnJyk7XHJcbiAgICByZXR1cm4gW21lbW9yeWluZm8sY3B1cmF0ZV07XHJcbn07XHJcblxyXG50ZXN0d2EuZ2V0U2NyZWVuc2hvdEFuZHJvaWQgPSBhc3luYyBmdW5jdGlvbiAoYW5kcm9pZERyaXZlciwgdGVtcFBuZykge1xyXG4gICAgY29uc3QgcG5nID0gJy9kYXRhL2xvY2FsL3RtcC9zY3JlZW5zaG90LnBuZyc7XHJcbiAgICBsZXQgY21kID0gIFsnL3N5c3RlbS9iaW4vcm0nLCBgJHtwbmd9O2AsICcvc3lzdGVtL2Jpbi9zY3JlZW5jYXAnLCAnLXAnLCBwbmddO1xyXG4gICAgYXdhaXQgYW5kcm9pZERyaXZlci5hZGIuc2hlbGwoY21kKTtcclxuICAgIGlmIChhd2FpdCBmcy5leGlzdHModGVtcFBuZykpIHtcclxuICAgICAgICBhd2FpdCBmcy51bmxpbmsodGVtcFBuZyk7XHJcbiAgICB9XHJcbiAgICBhd2FpdCBhbmRyb2lkRHJpdmVyLmFkYi5wdWxsKHBuZywgdGVtcFBuZyk7XHJcbn1cclxuXHJcbnRlc3R3YS5nZXRTY3JlZW5zaG90SU9TID0gYXN5bmMgZnVuY3Rpb24gKERyaXZlciwgdGVtcFBuZykge1xyXG4gICAgbGV0IGd1aWQgPSB1dWlkLmNyZWF0ZSgpO1xyXG4gICAgbGV0IHNob3RGaWxlID0gYHNjcmVlbnNob3Qke2d1aWR9YDtcclxuXHJcbiAgICBsZXQgc2hvdEZvbGRlciA9IFwiL3RtcC90ZXN0d2EtaW5zdHJ1bWVudHMvUnVuIDEvXCIrc2hvdEZpbGUrXCIucG5nXCI7O1xyXG4gICAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKHNob3RGb2xkZXIpKSkge1xyXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgQ3JlYXRpbmcgZm9sZGVyICcke3Nob3RGb2xkZXJ9J2ApO1xyXG4gICAgICAgIGF3YWl0IG1rZGlycChzaG90Rm9sZGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgc2hvdFBhdGggPSBwYXRoLnJlc29sdmUoc2hvdEZvbGRlciwgYCR7c2hvdEZpbGV9LnBuZ2ApO1xyXG4gICAgbG9nZ2VyLmRlYnVnKGBUYWtpbmcgc2NyZWVuc2hvdDogJyR7c2hvdFBhdGh9J2ApO1xyXG5cclxuICAgIGxldCB0YWtlU2NyZWVuU2hvdCA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChgYXUuY2FwdHVyZSgnJHtzaG90RmlsZX0nKWApO1xyXG5cclxuICAgICAgICBsZXQgc2NyZWVuc2hvdFdhaXRUaW1lb3V0ID0gKHRoaXMub3B0cy5zY3JlZW5zaG90V2FpdFRpbWVvdXQgfHwgMTApICogMTAwMDtcclxuICAgICAgICBsb2dnZXIuZGVidWcoYFdhaXRpbmcgJHtzY3JlZW5zaG90V2FpdFRpbWVvdXR9IG1zIGZvciBzY3JlZW5zaG90IHRvIGJlIGdlbmVyYXRlZC5gKTtcclxuICAgICAgICBsZXQgc3RhcnRNcyA9IERhdGUubm93KCk7XHJcblxyXG4gICAgICAgIGxldCBzdWNjZXNzID0gZmFsc2U7XHJcbiAgICAgICAgd2hpbGUgKChEYXRlLm5vdygpIC0gc3RhcnRNcykgPCBzY3JlZW5zaG90V2FpdFRpbWVvdXQpIHtcclxuICAgICAgICAgICAgaWYgKGF3YWl0IGZzLmhhc0FjY2VzcyhzaG90UGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXdhaXQgQi5kZWxheSgzMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoJ1RpbWVkIG91dCB3YWl0aW5nIGZvciBzY3JlZW5zaG90IGZpbGUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNoZWNrIHRoZSByb3RhdGlvbiwgYW5kIHJvdGF0ZSBpZiBuZWNlc3NhcnlcclxuICAgICAgICBpZiAoYXdhaXQgdGhpcy5nZXRPcmllbnRhdGlvbigpID09PSAnTEFORFNDQVBFJykge1xyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1JvdGF0aW5nIGxhbmRzY2FwZSBzY3JlZW5zaG90Jyk7XHJcbiAgICAgICAgICAgIGF3YWl0IHV0aWxzLnJvdGF0ZUltYWdlKHNob3RQYXRoLCAtOTApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmNwKHNob3RGb2xkZXIsdGVtcCxmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBsb2dnZXIuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb2dnZXIubG9nKCdzY3JlZW5zaG90IGRvbmUhJyk7fSk7XHJcblxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH07XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gdGVzdHdhOyJdfQ==